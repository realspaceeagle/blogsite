<!-- Related Posts Section -->
{{ $related := .Site.RegularPages.Related . | first 3 }}
{{ if $related }}
<div class="related-posts">
  <h3>Related Posts</h3>
  <div class="related-posts-grid">
    {{ range $related }}
    <article class="related-post">
      {{ if .Params.cover }}
      <div class="related-post-image">
        <a href="{{ .Permalink }}">
          <img src="{{ .Params.cover }}" alt="{{ .Title }}" loading="lazy">
        </a>
      </div>
      {{ end }}
      <div class="related-post-content">
        <h4><a href="{{ .Permalink }}">{{ .Title }}</a></h4>
        <p class="related-post-summary">{{ .Summary | truncate 100 }}</p>
        <div class="related-post-meta">
          <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2, 2006" }}</time>
          {{ if .Params.tags }}
          <div class="related-post-tags">
            {{ range first 2 .Params.tags }}
            <span class="tag">{{ . }}</span>
            {{ end }}
          </div>
          {{ end }}
        </div>
      </div>
    </article>
    {{ end }}
  </div>
</div>
{{ end }}